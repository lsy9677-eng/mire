<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë¯¸ë˜ì—”ìˆ˜í•™ ëŠ¥ë™í•´ëƒ„ êµì‹¤ ê´€ë¦¬</title>

    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css" rel="stylesheet">
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#3B82F6">

    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://t1.kakaocdn.net/kakao_js_sdk/2.7.0/kakao.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <style>
/* =========================================================
   2026 Parent-Friendly UI System (Mobile-first)
   - Soft card UI + gentle 3D
   - Bottom navigation on phone
   - Tablet kiosk: big, tappable 3D attendance cards
   ========================================================= */

:root{
  --brand-blue:#3B82F6;
  --brand-blue-700:#1D4ED8;
  --brand-blue-soft:#EFF6FF;

  --brand-yellow:#FACC15;
  --brand-yellow-soft:#FEF9C3;

  --ink:#0F172A;
  --ink-sub:#475569;

  --bg:#F8FAFC;
  --card:#FFFFFF;

  --line: rgba(15,23,42,.08);
  --shadow: 0 10px 30px rgba(15,23,42,.08);
  --shadow-soft: 0 6px 16px rgba(15,23,42,.08);

  --success:#22C55E;
  --warning:#F59E0B;
  --danger:#EF4444;

  --r-lg: 22px;
  --r-md: 16px;
  --r-sm: 12px;

  --tap: 48px;
}

*{ box-sizing:border-box; }
html,body{ height:100%; }
body{
  margin:0;
  font-family:'Pretendard', system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
  background: radial-gradient(1200px 600px at 30% -10%, #DBEAFE 0%, rgba(219,234,254,0) 60%),
              radial-gradient(900px 500px at 90% 10%, #FEF9C3 0%, rgba(254,249,195,0) 55%),
              var(--bg);
  color:var(--ink);
  -webkit-font-smoothing:antialiased;
 padding: 14px 12px 160px;
}

.container{
  max-width: 860px;
  margin: 0 auto;
  background: rgba(255,255,255,.72);
  border: 1px solid rgba(255,255,255,.6);
  backdrop-filter: blur(14px);
  border-radius: calc(var(--r-lg) + 6px);
  box-shadow: var(--shadow);
  padding: 14px;
}

/* ----- Header (Brand) ----- */
header{
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:12px;
  padding: 10px 10px 14px;
  border-bottom: 1px solid var(--line);
  margin-bottom: 12px;
}

.brand{
  display:flex;
  align-items:center;
  gap:10px;
  min-width:0;
}
.brand-mark{
  width: 38px;
  height: 38px;
  border-radius: 14px;
  object-fit: cover;
  box-shadow: 0 8px 20px rgba(59,130,246,.18);
  background: #fff;
  border: 1px solid rgba(15,23,42,.06);
}
.brand-title{
  display:flex;
  flex-direction:column;
  min-width:0;
}
.brand-title strong{
  font-size: 16px;
  font-weight: 900;
  letter-spacing: -0.2px;
  line-height: 1.1;
  white-space:nowrap;
  overflow:hidden;
  text-overflow:ellipsis;
}
.brand-title span{
  font-size: 12px;
  color: var(--ink-sub);
  white-space:nowrap;
  overflow:hidden;
  text-overflow:ellipsis;
}

.admin-switch{
  display:flex;
  align-items:center;
  gap:10px;
  padding: 8px 10px;
  border-radius: 999px;
  background: rgba(255,255,255,.65);
  border: 1px solid rgba(15,23,42,.06);
  box-shadow: 0 6px 16px rgba(15,23,42,.06);
  font-size: 12px;
  color: var(--ink-sub);
}
.admin-switch input{ transform: translateY(1px); }
#btnKioskStart{
  display:none;
  border:none;
  border-radius: 999px;
  padding: 10px 12px;
  font-weight: 800;
  color:#0F172A;
  background: linear-gradient(180deg, #FEF9C3 0%, #FDE68A 100%);
  box-shadow: 0 8px 18px rgba(250,204,21,.25);
  cursor:pointer;
}

/* ----- Pages / Tabs ----- */
.page{ display:none; animation: fadeIn .2s ease; }
.page.active{ display:block; }
@keyframes fadeIn{ from{opacity:0; transform:translateY(6px)} to{opacity:1; transform:none} }

/* Bottom Navigation (re-using existing .tabs markup) */
.tabs{
  position: fixed;
  left: 12px;
  right: 12px;
  bottom: 12px;
  z-index: 50;

  display:flex;
  gap: 8px;
  padding: 10px;
  border-radius: 999px;
  background: rgba(255,255,255,.78);
  border: 1px solid rgba(15,23,42,.08);
  backdrop-filter: blur(16px);
  box-shadow: 0 18px 40px rgba(15,23,42,.12);
}
.tab-btn{
  flex:1;
  min-height: var(--tap);
  border:none;
  border-radius: 999px;
  background: transparent;
  cursor:pointer;

  display:flex;
  align-items:center;
  justify-content:center;
  gap:8px;

  font-size: 13px;
  font-weight: 800;
  color: var(--ink-sub);
  transition: transform .12s ease, background .12s ease, color .12s ease;
}
.tab-btn i{ font-size: 16px; }
.tab-btn.active{
  background: linear-gradient(180deg, rgba(59,130,246,.18) 0%, rgba(59,130,246,.10) 100%);
  color: var(--brand-blue-700);
}
.tab-btn:active{ transform: scale(.98); }

/* On wider screens, make tabs inline (not fixed) */
@media (min-width: 900px){
  body{ padding-bottom: 14px; }
  .tabs{
    position: static;
    margin: 8px 0 14px;
    border-radius: 18px;
    box-shadow: 0 10px 26px rgba(15,23,42,.10);
  }
}

/* ----- Forms ----- */
.form-grid{
  display:grid;
  grid-template-columns: 1fr 1fr;
  gap: 12px;
}
.full-width{ grid-column: 1 / -1; }

label{
  display:block;
  font-size: 12px;
  font-weight: 800;
  color: var(--ink-sub);
  margin: 0 0 6px;
}
input, select, textarea{
  width:100%;
  min-height: var(--tap);
  padding: 12px 12px;
  border-radius: var(--r-md);
  border: 1px solid rgba(15,23,42,.10);
  background: rgba(255,255,255,.85);
  color: var(--ink);
  outline: none;
  font-size: 14px;
  transition: box-shadow .15s ease, border-color .15s ease, transform .05s ease;
}
textarea{ min-height: 110px; resize: vertical; }
input:focus, select:focus, textarea:focus{
  border-color: rgba(59,130,246,.55);
  box-shadow: 0 0 0 4px rgba(59,130,246,.14);
  background: #fff;
}
input::placeholder, textarea::placeholder{ color: rgba(71,85,105,.7); }

button{ min-height: var(--tap); }

button.action-btn{
  width:100%;
  border:none;
  border-radius: 18px;
  padding: 14px 14px;
  font-weight: 900;
  font-size: 15px;
  cursor:pointer;
  color: white;
  background: linear-gradient(180deg, var(--brand-blue) 0%, var(--brand-blue-700) 100%);
  box-shadow: 0 12px 28px rgba(59,130,246,.24);
  transition: transform .12s ease, box-shadow .12s ease, filter .12s ease;
}
button.action-btn:hover{ filter: brightness(1.02); }
button.action-btn:active{ transform: translateY(1px) scale(.995); box-shadow: 0 8px 22px rgba(59,130,246,.20); }
button.action-btn:disabled{
  opacity:.55;
  cursor:not-allowed;
  box-shadow:none;
}

/* ----- Filter Chips ----- */
.filter-container{
  border-radius: var(--r-lg);
  background: rgba(255,255,255,.75);
  border: 1px solid rgba(15,23,42,.08);
  box-shadow: var(--shadow-soft);
  padding: 12px;
  margin-bottom: 12px;
}
.filter-row{
  display:flex;
  align-items:center;
  gap:10px;
  flex-wrap: wrap;
  margin-bottom: 10px;
}
.filter-label{
  font-size:12px;
  font-weight:900;
  color: var(--ink-sub);
  padding: 6px 10px;
  border-radius: 999px;
  background: rgba(59,130,246,.10);
}
.filter-group{ display:flex; gap:6px; flex-wrap: wrap; flex: 1; }

.filter-chip{
  padding: 9px 12px;
  border-radius: 999px;
  border: 1px solid rgba(15,23,42,.08);
  background: rgba(255,255,255,.85);
  font-size: 13px;
  font-weight: 800;
  color: var(--ink-sub);
  cursor:pointer;
  transition: transform .12s ease, background .12s ease, color .12s ease;
}
.filter-chip.active{
  background: linear-gradient(180deg, rgba(250,204,21,.35) 0%, rgba(250,204,21,.18) 100%);
  border-color: rgba(250,204,21,.55);
  color: #7C5A00;
}

/* ----- Student Cards (Parent-friendly) ----- */
#studentListArea{
  display:grid;
  grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
  gap: 10px;
  padding: 4px;
}
.student-card{
  background: rgba(255,255,255,.92);
  border: 1px solid rgba(15,23,42,.08);
  border-radius: 20px;
  padding: 14px 12px;
  box-shadow: 0 10px 22px rgba(15,23,42,.08);
  cursor: pointer;
  position: relative;
  transition: transform .12s ease, box-shadow .12s ease, border-color .12s ease;
  height: 170px;

  display:flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  text-align:center;
}
.student-card:hover{
  transform: translateY(-2px);
  border-color: rgba(59,130,246,.25);
  box-shadow: 0 16px 30px rgba(15,23,42,.10);
}
.student-card:active{ transform: scale(.985); }

.chk-wrapper{ position:absolute; top:10px; left:10px; }
.list-chk{ width:20px; height:20px; accent-color: var(--brand-blue); }

.profile-wrapper{ width: 64px; height: 64px; margin-bottom: 8px; }
.profile-img{
  width:100%; height:100%;
  border-radius: 22px;
  object-fit: cover;
  background:#eee;
  border: 1px solid rgba(15,23,42,.06);
  box-shadow: 0 10px 20px rgba(15,23,42,.12);
}
.info-area{ width:100%; }
.info-area div:first-child{
  font-size: 15px;
  font-weight: 900;
  letter-spacing: -0.2px;
}
.info-area small{
  display:block;
  font-size: 12px;
  color: var(--ink-sub);
  margin-top: 2px;
  overflow:hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}
.grade-tag{
  display:inline-block;
  margin-left: 6px;
  padding: 3px 8px;
  border-radius: 999px;
  font-size: 11px;
  font-weight: 900;
  color: #0F172A;
  background: rgba(59,130,246,.12);
  border: 1px solid rgba(59,130,246,.18);
}

/* ----- Modal (Glass) ----- */
.modal-overlay{
  display:none;
  position: fixed;
  inset:0;
  background: rgba(2,6,23,.52);
  backdrop-filter: blur(6px);
  z-index: 100;
  justify-content:center;
  align-items:center;
  padding: 18px;
}
.modal{
  width: min(1100px, 98vw);
  max-height: 94vh;
  overflow:auto;
  border-radius: 26px;
  background: rgba(255,255,255,.92);
  border: 1px solid rgba(255,255,255,.55);
  box-shadow: 0 26px 70px rgba(2,6,23,.35);
  padding: 18px;
  position: relative;
}
.close-btn{
  position:absolute;
  right: 14px; top: 14px;
  width: 42px; height: 42px;
  border-radius: 999px;
  border: 1px solid rgba(15,23,42,.08);
  background: rgba(255,255,255,.75);
  cursor:pointer;
  font-size: 22px;
  color: var(--ink-sub);
}
.modal-header-profile{
  text-align:center;
  padding-bottom: 12px;
  margin-bottom: 12px;
  border-bottom: 1px solid rgba(15,23,42,.08);
}
.modal-tab-nav{
  display:flex;
  gap: 8px;
  padding: 8px;
  border-radius: 18px;
  background: rgba(59,130,246,.08);
  border: 1px solid rgba(59,130,246,.10);
  margin: 10px 0 12px;
}
.modal-tab-btn{
  flex:1;
  border:none;
  border-radius: 14px;
  background: transparent;
  padding: 12px 10px;
  font-weight: 900;
  color: var(--ink-sub);
  cursor:pointer;
}
.modal-tab-btn.active{
  background: rgba(255,255,255,.85);
  color: var(--brand-blue-700);
  box-shadow: 0 10px 18px rgba(15,23,42,.08);
}
.modal-tab-pane{ display:none; }
.modal-tab-pane.active{ display:block; }

.stat-box{
  display:flex;
  gap: 10px;
  background: rgba(59,130,246,.08);
  border: 1px solid rgba(59,130,246,.12);
  border-radius: 18px;
  padding: 12px;
}
.stat-num{ font-size: 20px; font-weight: 950; color: var(--brand-blue-700); }

/* Contact buttons (keep existing classes) */
.contact-row{ display:flex; justify-content:center; align-items:center; gap: 14px; flex-wrap: wrap; }
.contact-btn{
  width: 38px; height: 38px;
  border-radius: 999px;
  display:flex; align-items:center; justify-content:center;
  border: 1px solid rgba(15,23,42,.08);
  box-shadow: 0 10px 18px rgba(15,23,42,.10);
}
.btn-call{ background: rgba(34,197,94,.12); color: #166534; }
.btn-sms{ background: rgba(59,130,246,.12); color: #1D4ED8; }
.btn-kakao{ background: rgba(250,204,21,.25); color: #3c1e1e; }

/* ----- Toast (cute) ----- */
.toast{
  position: fixed;
  left:50%;
  bottom: calc(120px + env(safe-area-inset-bottom));
  transform: translateX(-50%) translateY(10px);
  opacity: 0;
  pointer-events:none;
  z-index: 9999;
  max-width: calc(100vw - 24px);

  display:flex;
  align-items:center;
  gap:10px;

  background: rgba(255,255,255,.88);
  border: 1px solid rgba(15,23,42,.10);
  box-shadow: 0 18px 40px rgba(2,6,23,.20);
  border-radius: 999px;
  padding: 12px 14px;
  color: var(--ink);
  font-weight: 800;
}
.toast.show{ opacity:1; transform: translateX(-50%) translateY(0); transition: opacity .16s ease, transform .16s ease; }
.toast .dot{ width:10px; height:10px; border-radius:999px; background: var(--success); }
.toast.error .dot{ background: var(--danger); }
.toast.warn .dot{ background: var(--warning); }

/* =========================================================
   Tablet Kiosk Mode (Attendance)
   - Big 3D cards
   - Minimal distractions
   ========================================================= */

body.kiosk-mode{
  padding: 0;
  background: radial-gradient(1100px 600px at 20% -10%, #DBEAFE 0%, rgba(219,234,254,0) 60%),
              radial-gradient(900px 500px at 95% 0%, #FEF9C3 0%, rgba(254,249,195,0) 55%),
              linear-gradient(180deg, #F8FAFC 0%, #EEF2FF 100%);
}

body.kiosk-mode .container{
  max-width: 100%;
  background: transparent;
  border: none;
  box-shadow: none;
  border-radius: 0;
  padding: 12px;
}

body.kiosk-mode header,
body.kiosk-mode .tabs,
body.kiosk-mode .filter-container,
body.kiosk-mode .admin-toolbar,
body.kiosk-mode .admin-only,
body.kiosk-mode #register,
body.kiosk-mode #calendar{
  display:none !important;
}
body.kiosk-mode #list{ display:block !important; }
body.kiosk-mode #studentListArea{
  grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));
  gap: 18px;
  padding: 8px;
}

/* Kiosk header category chips */
.kiosk-header{
  display:none;
  position: sticky;
  top: 0;
  z-index: 200;
  padding: 12px 10px;
  margin: 0 0 12px;
  border-radius: 22px;
  background: rgba(255,255,255,.82);
  border: 1px solid rgba(15,23,42,.08);
  backdrop-filter: blur(16px);
  box-shadow: 0 16px 40px rgba(15,23,42,.10);
  justify-content:center;
  gap: 8px;
  flex-wrap: wrap;
}
body.kiosk-mode .kiosk-header{ display:flex; }

.k-filter-btn{
  border:none;
  border-radius: 999px;
  padding: 12px 18px;
  font-size: 15px;
  font-weight: 950;
  cursor:pointer;
  color: var(--ink-sub);
  background: rgba(59,130,246,.08);
  border: 1px solid rgba(59,130,246,.12);
  transition: transform .12s ease, background .12s ease;
}
.k-filter-btn.active{
  background: linear-gradient(180deg, rgba(250,204,21,.55) 0%, rgba(250,204,21,.28) 100%);
  border-color: rgba(250,204,21,.60);
  color: #7C5A00;
  transform: scale(1.03);
}

/* Kiosk Exit button */
.kiosk-exit-btn{
  position: fixed;
  right: 18px;
  top: 18px;
  width: 56px;
  height: 56px;
  border-radius: 999px;
  display:none;
  align-items:center;
  justify-content:center;
  cursor:pointer;
  z-index: 99999;

  background: rgba(255,255,255,.72);
  border: 1px solid rgba(15,23,42,.10);
  box-shadow: 0 18px 40px rgba(2,6,23,.18);
  color: var(--brand-blue-700);
}
body.kiosk-mode .kiosk-exit-btn{ display:flex; }

/* Kiosk 3D cards (tap = attendance) */
body.kiosk-mode .student-card{
  height: 360px;
  padding: 18px 16px;
  border-radius: 28px;
  background: linear-gradient(180deg, rgba(255,255,255,.96) 0%, rgba(255,255,255,.82) 100%);
  border: 1px solid rgba(15,23,42,.10);

  box-shadow:
    0 16px 0 rgba(148,163,184,.35),
    0 28px 45px rgba(15,23,42,.18);
}
body.kiosk-mode .student-card:active{
  transform: translateY(10px);
  box-shadow:
    0 6px 0 rgba(148,163,184,.35),
    0 18px 32px rgba(15,23,42,.14);
}

/* Arrived state (soft green) */
body.kiosk-mode .student-card.arrived{
  background: linear-gradient(180deg, rgba(34,197,94,.18) 0%, rgba(255,255,255,.86) 70%);
  border-color: rgba(34,197,94,.25);
}

/* ----- Kiosk status (ë©€ë¦¬ì„œë„ êµ¬ë¶„) ----- */
.kiosk-pill{
  position:absolute;
  top: 14px;
  right: 14px;
  padding: 8px 12px;
  border-radius: 999px;
  font-weight: 950;
  font-size: 14px;
  letter-spacing: -0.2px;
  border: 1px solid rgba(15,23,42,.10);
  background: rgba(255,255,255,.85);
  box-shadow: 0 10px 20px rgba(15,23,42,.10);
}
.kiosk-pill.missing{ background: rgba(148,163,184,.22); border-color: rgba(148,163,184,.32); color:#334155; }
.kiosk-pill.arrived{ background: rgba(34,197,94,.22); border-color: rgba(34,197,94,.32); color:#14532d; }
.kiosk-pill.left{ background: rgba(100,116,139,.18); border-color: rgba(100,116,139,.28); color:#334155; }

.kiosk-hint{
  margin-top: 10px;
  width:100%;
  padding: 10px 12px;
  border-radius: 18px;
  font-weight: 900;
  font-size: 14px;
  color: var(--ink-sub);
  background: rgba(59,130,246,.08);
  border: 1px solid rgba(59,130,246,.10);
}
.kiosk-hint strong{ color: var(--brand-blue-700); }

body.kiosk-mode .student-card.missing{
  background: linear-gradient(180deg, rgba(148,163,184,.18) 0%, rgba(255,255,255,.86) 70%);
  border-color: rgba(148,163,184,.30);
  filter: saturate(.92);
}
body.kiosk-mode .student-card.left{
  background: linear-gradient(180deg, rgba(100,116,139,.14) 0%, rgba(255,255,255,.82) 75%);
  border-color: rgba(100,116,139,.26);
  opacity: .72;
  filter: grayscale(.22);
}
body.kiosk-mode .student-card.left .profile-img{ filter: grayscale(.35); opacity:.9; }

/* Bigger profile + name */
body.kiosk-mode .profile-wrapper{ width: 150px; height: 150px; margin-bottom: 14px; }
body.kiosk-mode .profile-img{ border-radius: 28px; }
body.kiosk-mode .info-area div:first-child{ font-size: 28px; }
body.kiosk-mode .info-area small{ font-size: 14px; }

/* Keep existing kiosk buttons if your JS injects them */
body.kiosk-mode .kiosk-btn-group{
  display:flex;
  gap: 10px;
  width:100%;
  margin-top: auto;
}
.k-btn{
  flex:1;
  border:none;
  border-radius: 18px;
  padding: 14px 0;
  font-size: 16px;
  font-weight: 950;
  cursor:pointer;
  box-shadow: 0 14px 26px rgba(2,6,23,.10);
}
.k-btn-in{ background: linear-gradient(180deg, rgba(250,204,21,.80) 0%, rgba(250,204,21,.55) 100%); color:#7C5A00; }
.k-btn-out{ background: rgba(59,130,246,.12); color: var(--brand-blue-700); border: 1px solid rgba(59,130,246,.18); }

.k-btn:disabled{
  opacity:.55;
  cursor:not-allowed;
  box-shadow:none;
}

/* Small tweaks */
.dept-badge{ border-radius: 999px; padding: 3px 8px; font-weight: 900; }


/* ===== Calendar (restored & modernized) ===== */
#calendar .calendar-controls{
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap: 10px;
  padding: 12px;
  border-radius: var(--r-lg);
  background: rgba(255,255,255,.78);
  border: 1px solid rgba(15,23,42,.08);
  box-shadow: var(--shadow-soft);
  margin-bottom: 12px;
}
#calendar .cal-btn{
  min-height: var(--tap);
  padding: 10px 12px;
  border:none;
  border-radius: 16px;
  font-weight: 950;
  cursor:pointer;
  background: rgba(59,130,246,.10);
  color: var(--brand-blue-700);
}
#calendar .current-date{
  font-size: 18px;
  font-weight: 950;
  letter-spacing: -0.3px;
  color: var(--ink);
}

.calendar-grid{
  display:grid;
  grid-template-columns: repeat(7, 1fr);
  gap: 8px;
}
.day-name{
  text-align:center;
  font-weight: 950;
  font-size: 12px;
  color: var(--ink-sub);
  padding: 6px 0;
}
.day-cell{
  border-radius: 16px;
  border: 1px solid rgba(15,23,42,.08);
  background: rgba(255,255,255,.86);
  box-shadow: 0 8px 18px rgba(15,23,42,.06);
  min-height: 54px;
  padding: 6px 6px 10px;
  cursor:pointer;
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:flex-start;
  transition: transform .12s ease, box-shadow .12s ease;
}
.day-cell:hover{
  transform: translateY(-1px);
  box-shadow: 0 12px 24px rgba(15,23,42,.08);
}
.day-num{
  font-size: 12px;
  font-weight: 950;
  color: var(--ink);
}
.day-cell.selected{
  outline: 4px solid rgba(59,130,246,.18);
  border-color: rgba(59,130,246,.35);
}
.event-dot{
  width: 7px; height: 7px;
  border-radius: 999px;
  margin-top: 4px;
}
.dot-schedule{ background: rgba(59,130,246,.90); }
.dot-birthday{ background: rgba(250,204,21,.95); }

#dateDetailArea{
  margin-top: 12px;
  border-radius: var(--r-lg);
  background: rgba(255,255,255,.78);
  border: 1px solid rgba(15,23,42,.08);
  box-shadow: var(--shadow-soft);
  padding: 12px;
}
.view-mode-group{
  display:flex;
  gap: 8px;
  justify-content:center;
  flex-wrap: wrap;
  margin-bottom: 10px;
}
.view-mode-btn{
  border:none;
  border-radius: 999px;
  padding: 10px 14px;
  font-weight: 950;
  cursor:pointer;
  background: rgba(59,130,246,.08);
  color: var(--ink-sub);
}
.view-mode-btn.active{
  background: linear-gradient(180deg, rgba(250,204,21,.55) 0%, rgba(250,204,21,.26) 100%);
  color: #7C5A00;
  border: 1px solid rgba(250,204,21,.55);
}

/* ===== Admin selection layout fixes (ì›ìƒê´€ë¦¬) ===== */
body.show-admin #studentListArea{
  grid-template-columns: 1fr !important;
}
body.show-admin .student-card{
  height: auto !important;
  flex-direction: row !important;
  justify-content:flex-start !important;
  text-align:left !important;
  gap: 12px;
  padding: 12px 14px;
}
body.show-admin .profile-wrapper{
  width: 56px !important;
  height: 56px !important;
  margin: 0 !important;
}
body.show-admin .profile-img{ border-radius: 18px !important; }
body.show-admin .info-area{ width: auto !important; flex: 1; }
body.show-admin .chk-wrapper{
  position: static !important;
  margin-left: auto;
  width: auto;
  display:flex;
  align-items:center;
}
body.show-admin .list-chk{
  width: 22px;
  height: 22px;
}
body.show-admin #selectedCount{
  padding: 6px 10px;
  border-radius: 999px;
  background: rgba(59,130,246,.10);
  border: 1px solid rgba(59,130,246,.12);
}
body.show-admin #selectAll{
  width: 20px;
  height: 20px;
  accent-color: var(--brand-blue);
}

/* ===== Cute sparkle (cat accent) ===== */
.sparkle-fx{
  position: absolute;
  width: 16px;
  height: 16px;
  pointer-events:none;
  animation: sparkle-pop .55s ease-out forwards;
  filter: drop-shadow(0 10px 14px rgba(250,204,21,.25));
}
@keyframes sparkle-pop{
  0%{ transform: translate(-50%,-50%) scale(.2); opacity:0; }
  35%{ opacity:1; transform: translate(-50%,-50%) scale(1); }
  100%{ opacity:0; transform: translate(-50%,-80%) scale(.8); }
}


/* =========================
   KIOSK: True metal/plastic card feel + remove ghost print text
   ========================= */

/* Hide print area during normal use (it was showing at bottom) */
#printArea{ display:none !important; }

/* Print support: show printArea only when printing */
@media print{
  body{ background:#fff !important; padding:0 !important; }
  body > *:not(#printArea){ display:none !important; }
  #printArea{
    display:block !important;
    position: static !important;
    width: 210mm !important;
    padding: 10mm !important;
  }
}

/* Remove any watermark/label that looks like floating text */
.card-label{ display:none !important; }

/* Stronger "kiosk" look */
body.kiosk-mode{
  background:
    radial-gradient(900px 540px at 15% 0%, rgba(59,130,246,.28) 0%, rgba(59,130,246,0) 55%),
    radial-gradient(720px 520px at 85% 10%, rgba(250,204,21,.30) 0%, rgba(250,204,21,0) 55%),
    linear-gradient(180deg, #F8FAFC 0%, #EEF2FF 100%) !important;
}

/* Kiosk cards: metal + plastic hybrid */
body.kiosk-mode .student-card{
  height: 380px;
  border-radius: 30px;
  padding: 18px 16px;
  cursor: pointer;

  /* "metal shell" */
  background:
    radial-gradient(140px 120px at 25% 22%, rgba(255,255,255,.95) 0%, rgba(255,255,255,0) 60%),
    radial-gradient(260px 180px at 70% 28%, rgba(255,255,255,.55) 0%, rgba(255,255,255,0) 62%),
    linear-gradient(135deg, rgba(15,23,42,.10) 0%, rgba(255,255,255,.92) 22%, rgba(255,255,255,.86) 60%, rgba(15,23,42,.10) 100%);

  border: 1px solid rgba(15,23,42,.12);

  /* 3D plate + floor shadow */
  box-shadow:
    0 18px 0 rgba(148,163,184,.30),
    0 34px 54px rgba(2,6,23,.22);

  position: relative;
  overflow: hidden;
  transform: translateZ(0);
}

/* glossy highlight strip */
body.kiosk-mode .student-card::before{
  content:"";
  position:absolute;
  inset: -40% -30%;
  background: linear-gradient(115deg,
    rgba(255,255,255,0) 20%,
    rgba(255,255,255,.28) 38%,
    rgba(255,255,255,0) 58%);
  transform: rotate(12deg);
  opacity: .9;
  pointer-events:none;
}

/* subtle noise to feel "plastic" */
body.kiosk-mode .student-card::after{
  content:"";
  position:absolute;
  inset:0;
  background-image:
    radial-gradient(rgba(15,23,42,.06) 1px, rgba(255,255,255,0) 1px);
  background-size: 18px 18px;
  opacity: .06;
  mix-blend-mode: multiply;
  pointer-events:none;
}

body.kiosk-mode .student-card:active{
  transform: translateY(12px);
  box-shadow:
    0 8px 0 rgba(148,163,184,.28),
    0 22px 36px rgba(2,6,23,.18);
}

/* Arrived state: green glow rim */
body.kiosk-mode .student-card.arrived{
  border-color: rgba(34,197,94,.30) !important;
  box-shadow:
    0 18px 0 rgba(148,163,184,.28),
    0 34px 54px rgba(2,6,23,.20),
    0 0 0 2px rgba(34,197,94,.18) inset,
    0 0 26px rgba(34,197,94,.14);
}

/* Profile: inset frame like ID */
body.kiosk-mode .profile-wrapper{
  width: 154px;
  height: 154px;
  border-radius: 26px;
  padding: 6px;
  background:
    linear-gradient(145deg, rgba(255,255,255,.9) 0%, rgba(15,23,42,.08) 100%);
  box-shadow:
    0 10px 22px rgba(2,6,23,.20),
    0 0 0 1px rgba(15,23,42,.10) inset;
}
body.kiosk-mode .profile-img{
  border-radius: 20px;
}

/* Title typography */
body.kiosk-mode .info-area div:first-child{
  font-size: 30px !important;
  letter-spacing: -0.6px;
}
body.kiosk-mode .info-area small{
  font-size: 14px !important;
  color: rgba(71,85,105,.85) !important;
}

/* Buttons: tactile plastic/metal */
body.kiosk-mode .kiosk-btn-group{ gap: 12px; }

.k-btn{
  border-radius: 20px !important;
  font-size: 17px !important;
  font-weight: 950 !important;
  letter-spacing: -0.2px;
  position: relative;
  overflow: hidden;
}

.k-btn::before{
  content:"";
  position:absolute;
  inset:0;
  background: linear-gradient(180deg, rgba(255,255,255,.55) 0%, rgba(255,255,255,0) 55%);
  opacity:.55;
  pointer-events:none;
}

/* "Gold plastic" for ë“±ì› */
.k-btn-in{
  background:
    radial-gradient(120px 60px at 30% 20%, rgba(255,255,255,.75) 0%, rgba(255,255,255,0) 60%),
    linear-gradient(135deg, rgba(161,98,7,.22) 0%, rgba(250,204,21,.95) 26%, rgba(250,204,21,.62) 70%, rgba(161,98,7,.22) 100%) !important;
  color: #3B2A00 !important;
  border: 1px solid rgba(161,98,7,.22) !important;
  box-shadow:
    0 10px 0 rgba(161,98,7,.20),
    0 18px 28px rgba(2,6,23,.18) !important;
}

/* "Steel" for í•˜ì› */
.k-btn-out{
  background:
    radial-gradient(120px 60px at 30% 20%, rgba(255,255,255,.8) 0%, rgba(255,255,255,0) 60%),
    linear-gradient(135deg, rgba(15,23,42,.18) 0%, rgba(226,232,240,.95) 28%, rgba(203,213,225,.70) 70%, rgba(15,23,42,.14) 100%) !important;
  color: #0F172A !important;
  border: 1px solid rgba(15,23,42,.14) !important;
  box-shadow:
    0 10px 0 rgba(15,23,42,.12),
    0 18px 28px rgba(2,6,23,.16) !important;
}

.k-btn:active{
  transform: translateY(6px) !important;
  box-shadow: none !important;
}

/* Kiosk exit button: clearer */
/* ì¢…ë£Œ ë²„íŠ¼ ìœ„ì¹˜ ìˆ˜ì • (ìƒë‹¨ ì˜¤ë¥¸ìª½) */
body.kiosk-mode .kiosk-exit-btn {
    display: flex !important;
    top: 25px !important;    /* ìœ„ìª½ìœ¼ë¡œ ì´ë™ */
    right: 25px !important;  /* ì˜¤ë¥¸ìª½ ë²½ì— ë¶™ì„ */
    bottom: auto !important; /* ì•„ë˜ìª½ í•´ì œ */
    left: auto !important;   /* ì™¼ìª½ í•´ì œ */
    width: 45px;
    height: 45px;
    opacity: 0.4; /* í‰ì†Œì—” ì—°í•˜ê²Œ */
}
/* Kiosk header chips slightly more premium */
body.kiosk-mode .kiosk-header{
  border-radius: 26px !important;
}
/* [ìˆ˜ì •] ì‹ ê·œ ë“±ë¡ í™”ë©´ í•˜ë‹¨ ì—¬ë°± ì¶”ê°€ (ë²„íŠ¼ ê°€ë¦¼ ë°©ì§€) */
    #register {
        padding-bottom: 90px !important;
    }

    /* [ìˆ˜ì •] ì„ ìƒë‹˜ ëª¨ë“œ ì‹œ ì„¤ì • ë²„íŠ¼ ê°•ì œ í‘œì‹œ */
    body.show-admin .admin-only {
    display: inline-block !important; /* flex ëŒ€ì‹  blockì´ë‚˜ inline-block ì‚¬ìš© */
}
/* í•™ìƒ ì •ë³´ ìˆ˜ì • ë°•ìŠ¤ëŠ” ê½‰ ì°¨ê²Œ ë³´ì´ë„ë¡ ë³„ë„ ì§€ì • */
body.show-admin div.info-box.admin-only {
    display: block !important;
}
/* =========================================
   1. ë©”ë‰´ ë²„íŠ¼ ìƒë‹¨ ë°°ì¹˜ & ëª¨ë°”ì¼ ìµœì í™”
   ========================================= */
.tabs {
    position: sticky; /* ìŠ¤í¬ë¡¤ ë‚´ë ¤ë„ ìƒë‹¨ì— ê³ ì • */
    top: 0;
    z-index: 90;
    margin: 0 0 15px 0;
    padding: 8px;
    background: rgba(255,255,255,0.95);
    backdrop-filter: blur(10px);
    border-radius: 0 0 16px 16px; /* ì•„ë˜ìª½ë§Œ ë‘¥ê¸€ê²Œ */
    border-bottom: 1px solid rgba(0,0,0,0.05);
    box-shadow: 0 4px 15px rgba(0,0,0,0.03);
    width: 100%; /* ê°€ë¡œ ê½‰ ì°¨ê²Œ */
    left: 0;
}
/* íƒ­ ë²„íŠ¼ ìŠ¤íƒ€ì¼ ë‹¨ìˆœí™” */
.tab-btn {
    border-radius: 12px;
    font-size: 14px;
    padding: 8px 0; /* ë†’ì´ ì¡°ì ˆ */
}

/* ë³¸ë¬¸ ì—¬ë°± ì¬ì¡°ì • (ë²„íŠ¼ì´ ìœ„ë¡œ ê°”ìœ¼ë¯€ë¡œ ì•„ë˜ ì—¬ë°± ì œê±°) */
body { padding-bottom: 20px !important; }
#register { padding-bottom: 20px !important; }


/* =========================================
   2. [ì¶œì„ë¶€ ëª¨ë“œ] 3D ì…ì²´ ë²„íŠ¼ & ì¹´ë“œ ë””ìì¸
   ========================================= */

/* (1) ë¶„ë¥˜ ë²„íŠ¼ (ì „ì²´, ë¯¸ì·¨í•™...) - ì…ì²´ê° ê°•í™” */
.kiosk-header {
    gap: 8px;
    padding: 10px;
    background: transparent;
    box-shadow: none;
    border: none;
}
.k-filter-btn {
    background: #ffffff;
    border: 1px solid #cbd5e1;
    border-bottom: 4px solid #94a3b8; /* ë‘êº¼ìš´ í•˜ë‹¨ í…Œë‘ë¦¬ë¡œ 3D íš¨ê³¼ */
    border-radius: 12px;
    color: #64748b;
    padding: 12px 16px;
    font-size: 16px;
    font-weight: 800;
    transform: translateY(0);
    transition: all 0.1s;
    box-shadow: 0 4px 6px rgba(0,0,0,0.05);
}
.k-filter-btn:active,
.k-filter-btn.active {
    background: #ffeb3b; /* ì¨í•œ ë…¸ë€ìƒ‰ */
    color: #5d4037;
    border-color: #fbc02d;
    border-bottom-width: 2px; /* ëˆŒë ¸ì„ ë•Œ ë†’ì´ ì¤„ì„ */
    transform: translateY(2px); /* ëˆŒë¦¬ëŠ” ì• ë‹ˆë©”ì´ì…˜ */
    box-shadow: inset 0 2px 4px rgba(0,0,0,0.1);
}

/* (2) í•™ìƒ ì¹´ë“œ ìƒíƒœë³„ ë””ìì¸ (í™•ì‹¤í•œ êµ¬ë¶„) */
body.kiosk-mode .student-card {
    transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
    height: 320px; /* ì¹´ë“œ ë†’ì´ ì¡°ì • */
}

/* [ìƒíƒœ 1: ë¯¸ë“±ì›] - ê¹”ë”í•œ í°ìƒ‰ */
body.kiosk-mode .student-card.missing {
    background: #ffffff;
    border: 1px solid #e2e8f0;
    box-shadow: 0 8px 0 #cbd5e1; /* íšŒìƒ‰ ê·¸ë¦¼ì */
    opacity: 1;
}
body.kiosk-mode .student-card.missing .profile-img {
    filter: grayscale(0%); /* ì‚¬ì§„ ì„ ëª…í•˜ê²Œ */
}

/* [ìƒíƒœ 2: ë“±ì›ì™„ë£Œ] - ëˆˆì— ë„ëŠ” ì´ˆë¡ìƒ‰ í…Œë‘ë¦¬ & ì…ì²´ê° */
body.kiosk-mode .student-card.arrived {
    background: linear-gradient(135deg, #ffffff 40%, #dcfce7 100%);
    border: 3px solid #22c55e; /* êµµì€ ì´ˆë¡ í…Œë‘ë¦¬ */
    box-shadow: 0 8px 0 #15803d; /* ì§„í•œ ì´ˆë¡ ê·¸ë¦¼ì */
    transform: translateY(-2px);
}
body.kiosk-mode .student-card.arrived .kiosk-pill {
    background: #22c55e;
    color: white;
    border: none;
    font-size: 16px;
    box-shadow: 0 4px 10px rgba(34,197,94,0.4);
}

/* [ìƒíƒœ 3: í•˜ì›ì™„ë£Œ] - ì–´ë‘¡ê³  íë¦¿í•˜ê²Œ (í™•ì‹¤íˆ êº¼ì§„ ëŠë‚Œ) */
body.kiosk-mode .student-card.left {
    background: #f1f5f9;
    border: 2px dashed #94a3b8;
    box-shadow: none; /* ê·¸ë¦¼ì ì—†ìŒ (ë‚©ì‘í•˜ê²Œ) */
    opacity: 0.5; /* ë°˜íˆ¬ëª… */
    transform: scale(0.95); /* ì•½ê°„ ì¶•ì†Œ */
    filter: grayscale(100%); /* í‘ë°± ì²˜ë¦¬ */
}

/* í‚¤ì˜¤ìŠ¤í¬ ëª¨ë“œì—ì„œ ë¶ˆí•„ìš”í•œ ìš”ì†Œ ì™„ë²½ ì œê±° */
body.kiosk-mode .tabs,
body.kiosk-mode header,
body.kiosk-mode .kiosk-btn-group,
body.kiosk-mode .kiosk-exit-btn {
    /* ì €ì¥/ì·¨ì†Œ/ë©”ë‰´ ë“± ë²„íŠ¼ ì•„ì˜ˆ ì•ˆ ë³´ì´ê²Œ ì²˜ë¦¬ */
    /* ë‹¨, ì¢…ë£Œ ë²„íŠ¼ì´ í•„ìš”í•˜ë©´ kiosk-exit-btnì€ ì œì™¸í•˜ì„¸ìš” */
   display: none !important;
}

/* ì¢…ë£Œ ë²„íŠ¼ì€ ë¹„ìƒìš©ìœ¼ë¡œ ì¢Œì¸¡ í•˜ë‹¨ì— íˆ¬ëª…í•˜ê²Œ ìˆ¨ê¹€ (ì„¸ ë²ˆ íƒ­ ê¸°ëŠ¥ ë“± ëŒ€ì²´ ê°€ëŠ¥í•˜ì§€ë§Œ ì¼ë‹¨ ì‘ê²Œ í‘œì‹œ) */
body.kiosk-mode .kiosk-exit-btn {
    display: flex !important;
    top: auto; bottom: 20px; left: 20px; right: auto;
    width: 40px; height: 40px;
    opacity: 0.3;
}
/* (í˜¹ì‹œ ëª¨ë¥¼ í‚¤ì˜¤ìŠ¤í¬ ìƒë‹¨ ë¶„ë¥˜ ë²„íŠ¼ë„ ê°™ì´ ê³ ì • í•´ì œ) */
.kiosk-header {
    position: relative !important;
    top: auto !important;
}
/* [ìˆ˜ì •] ì¼ë°˜ ëª¨ë“œ ì›ìƒ ì¹´ë“œ ì‚¬ì§„ í™•ëŒ€ */

/* 1. ì¹´ë“œ ì „ì²´ ë†’ì´ë¥¼ ëŠ˜ë¦¼ (ì‚¬ì§„ì´ ì»¤ì§„ ë§Œí¼ ê³µê°„ í™•ë³´) */
.student-card {
    height: 210px !important; /* ê¸°ì¡´ 170px -> 210pxë¡œ ë³€ê²½ */
}

/* 2. ì‚¬ì§„ í¬ê¸°ë¥¼ ëŒ€í­ í™•ëŒ€ */
.profile-wrapper {
    width: 100px !important;  /* ê¸°ì¡´ 64px -> 100px */
    height: 100px !important; /* ì •ì‚¬ê°í˜• ìœ ì§€ */
    margin-bottom: 12px !important; /* ì‚¬ì§„ê³¼ ì´ë¦„ ì‚¬ì´ ê°„ê²© ë²Œë¦¼ */
    box-shadow: 0 8px 20px rgba(0,0,0,0.08); /* ê·¸ë¦¼ìë„ ì‚´ì§ ì§„í•˜ê²Œ */
}

/* 3. ì‚¬ì§„ í…Œë‘ë¦¬ ë‘¥ê¸€ê¸° ì¡°ì ˆ (ì„ íƒì‚¬í•­) */
.profile-img {
    border-radius: 30px !important; /* ì¡°ê¸ˆ ë” ë‘¥ê¸€ê²Œ */
}

/* 4. ì´ë¦„ ê¸€ì í¬ê¸°ë„ ê· í˜•ì— ë§ì¶° ì•½ê°„ í‚¤ì›€ */
.info-area div:first-child {
    font-size: 17px !important;
    margin-bottom: 5px !important;
}
/* [ìˆ˜ì •] ë¸Œëœë“œ ë¡œê³  ë° íƒ€ì´í‹€ í¬ê¸° í™•ëŒ€ */
.brand-mark {
    width: 54px !important;       /* ë¡œê³  ê°€ë¡œ í¬ê¸° (ê¸°ì¡´ 38px) */
    height: 54px !important;      /* ë¡œê³  ì„¸ë¡œ í¬ê¸° */
    border-radius: 18px !important; /* ëª¨ì„œë¦¬ ë‘¥ê¸€ê¸° */
    box-shadow: 0 4px 12px rgba(59,130,246,0.25) !important; /* ê·¸ë¦¼ì ê°•ì¡° */
}

.brand-title strong {
    font-size: 21px !important;   /* ì œëª© ê¸€ì í¬ê¸° (ê¸°ì¡´ 16px) */
    letter-spacing: -0.5px !important; /* ìê°„ ì¡°ì ˆ */
    margin-bottom: 3px !important;
}

.brand-title span {
    font-size: 13px !important;   /* ì•„ë˜ ì‘ì€ ì„¤ëª…ê¸€ë„ ì‚´ì§ í‚¤ì›€ */
    color: #64748b !important;    /* ê¸€ììƒ‰ì„ ì¡°ê¸ˆ ë” ì§„í•˜ê²Œ */
}

/* ë¡œê³ ì™€ ê¸€ì ì‚¬ì´ ê°„ê²©ë„ ì¡°ê¸ˆ ë„“í˜ */
.brand {
    gap: 14px !important;
}
/* [ìˆ˜ì •] í•™ìŠµì¼ì • ì²´í¬ë°•ìŠ¤ í¬ê¸° ì¡°ì ˆ ë° ì •ë ¬ */
#calendar .filter-group {
    display: flex !important;       /* ê°€ë¡œë¡œ ë‚˜ë€íˆ ë°°ì¹˜ */
    justify-content: center !important; /* ê°€ìš´ë° ì •ë ¬ */
    gap: 24px !important;           /* 'í•™ì›ì¼ì •'ê³¼ 'ìƒì¼' ì‚¬ì´ ê°„ê²© */
    margin-bottom: 18px !important;
}

#calendar .filter-group label {
    display: inline-flex !important; /* ê¸€ìì™€ ì²´í¬ë°•ìŠ¤ë¥¼ í•œ ì¤„ë¡œ */
    align-items: center !important;  /* ìˆ˜ì§ ì¤‘ì•™ ì •ë ¬ */
    gap: 8px !important;             /* ì²´í¬ë°•ìŠ¤ì™€ ê¸€ì ì‚¬ì´ ê°„ê²© */
    font-size: 15px !important;      /* ê¸€ì í¬ê¸° ì ë‹¹í•˜ê²Œ */
    font-weight: 700 !important;     /* ê¸€ì êµµê²Œ */
    cursor: pointer;
    width: auto !important;          /* ê½‰ ì°¨ëŠ” ë¬¸ì œ í•´ê²° */
    margin: 0 !important;
}

#calendar .filter-group input[type="checkbox"] {
    width: 22px !important;          /* ê°€ë¡œ í¬ê¸° ì¶•ì†Œ */
    height: 22px !important;         /* ì„¸ë¡œ í¬ê¸° ì¶•ì†Œ */
    min-height: 0 !important;        /* ìµœì†Œ ë†’ì´ ì œí•œ í•´ì œ */
    margin: 0 !important;            /* ë¶ˆí•„ìš”í•œ ì—¬ë°± ì œê±° */
    accent-color: #3B82F6;           /* ì²´í¬í–ˆì„ ë•Œ ë¸Œëœë“œ ìƒ‰ìƒ(íŒŒë‘) */
    cursor: pointer;
    transform: translateY(-1px);     /* ê¸€ìì™€ ë†’ì´ ë¯¸ì„¸ ì¡°ì • */
}


/* Fullscreen detail modal */
.modal.modal-full{
  width: min(1200px, 100vw);
  height: 94vh;
  max-height: 94vh;
}
@media (max-width: 640px){
  .modal{ width: 100vw !important; height: 100vh !important; max-height: 100vh !important; border-radius: 0 !important; }
  .modal.modal-full{ width: 100vw !important; height: 100vh !important; max-height: 100vh !important; }
  .modal-overlay{ padding: 0 !important; }
}
/* =========================================
   [ìˆ˜ì •] ìƒì„¸ íŒì—… ë ˆì´ì•„ì›ƒ ê°œì„  (ì„ ìƒë‹˜ ëª¨ë“œ ìµœì í™”)
   ========================================= */

/* ëª¨ë‹¬ ì „ì²´ í¬ê¸° ë° ìŠ¤í¬ë¡¤ ê³ ì • */
.modal {
    display: flex;
    flex-direction: column;
    max-height: 90vh !important; /* í™”ë©´ ê½‰ ì°¨ì§€ ì•Šê²Œ */
    height: auto;
    overflow: hidden; /* ì „ì²´ ìŠ¤í¬ë¡¤ ë°©ì§€ */
    padding: 0 !important; /* ë‚´ë¶€ íŒ¨ë”© ì œê±° (êµ¬ì—­ë³„ë¡œ ì¤Œ) */
}

/* 1. ìƒë‹¨ í”„ë¡œí•„ ì˜ì—­ (ê³ ì •) */
.modal-header-fixed {
    background: #fff;
    padding: 20px 20px 10px 20px;
    border-bottom: 1px solid #eee;
    flex-shrink: 0; /* í¬ê¸° ì¤„ì–´ë“¤ì§€ ì•ŠìŒ */
    z-index: 10;
}

/* ë‹«ê¸° ë²„íŠ¼ ìœ„ì¹˜ ì¡°ì • */
.close-btn {
    top: 15px;
    right: 15px;
    z-index: 20;
    background: #f1f5f9;
}

/* 2. íƒ­ ë²„íŠ¼ ì˜ì—­ (ê³ ì •) */
.modal-tab-nav {
    margin: 0 20px;
    flex-shrink: 0;
}

/* 3. í•˜ë‹¨ ì½˜í…ì¸  ì˜ì—­ (ì—¬ê¸°ë§Œ ìŠ¤í¬ë¡¤) */
.modal-body-scroll {
    flex: 1;
    overflow-y: auto;
    padding: 20px;
    background: #f8fafc; /* ë°°ê²½ìƒ‰ ì‚´ì§ ë‹¤ë¥´ê²Œ */
}

/* íƒ­ ë‚´ë¶€ ë°•ìŠ¤ ë””ìì¸ í†µì¼ */
.info-box {
    background: #fff;
    border: 1px solid #e2e8f0;
    border-radius: 12px;
    padding: 15px;
    margin-bottom: 15px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.03);
}

.info-box h4 {
    margin: 0 0 12px 0;
    font-size: 15px;
    color: #334155;
    border-bottom: 2px solid #f1f5f9;
    padding-bottom: 8px;
}

/* [ì¤‘ìš”] ì •ë³´ ìˆ˜ì • í¼ 2ë‹¨ ë°°ì—´ (ê³µê°„ ì ˆì•½) */
#modalEditForm {
    display: grid;
    grid-template-columns: 1fr 1fr; /* ì¢Œìš° 2ì¹¸ */
    gap: 12px 10px; /* ì„¸ë¡œ ê°€ë¡œ ê°„ê²© */
}
/* ëª¨ë°”ì¼ì—ì„œëŠ” 1ë‹¨ìœ¼ë¡œ */
@media (max-width: 480px) {
    #modalEditForm { grid-template-columns: 1fr; }
}

#modalEditForm label {
    font-size: 11px;
    color: #64748b;
    margin-bottom: 4px;
}
#modalEditForm input,
#modalEditForm select,
#modalEditForm textarea {
    min-height: 38px;
    padding: 8px;
    font-size: 13px;
    background: #f8fafc;
}
#modalEditForm .full-row {
    grid-column: 1 / -1; /* ê°€ë¡œ ì „ì²´ ì°¨ì§€ */
}
</style>
</head>
<body>

<div class="kiosk-exit-btn" onclick="exitKioskMode()">
    <i class="fas fa-lock"></i>
</div>

<div class="container">
    <div class="kiosk-header" id="kioskHeader">
        <button class="k-filter-btn active" onclick="setKioskCategory('all', this)">ì „ì²´</button>
        <button class="k-filter-btn" onclick="setKioskCategory('ë¯¸ì·¨í•™', this)">ë¯¸ì·¨í•™</button>
        <button class="k-filter-btn" onclick="setKioskCategory('ì´ˆë“±', this)">ì´ˆë“±ë¶€</button>
        <button class="k-filter-btn" onclick="setKioskCategory('ì¤‘ë“±', this)">ì¤‘ë“±ë¶€</button>
        <button class="k-filter-btn" onclick="setKioskCategory('ê³ ë“±', this)">ê³ ë“±ë¶€</button>
    </div>

<header>
        <div class="brand">
            <img class="brand-mark"
                 src="nam-512.png"
                 alt="ëŠ¥ë™í•´ëƒ„"
                 style="background:#fff; object-fit:contain;"
                 onerror="this.src='https://cdn-icons-png.flaticon.com/512/3468/3468306.png'">

            <div class="brand-title">
                <strong>ë¯¸ë˜ì—”ìˆ˜í•™ ëŠ¥ë™í•´ëƒ„</strong>
                <span>í•™ë¶€ëª¨ìš© Â· ì•Œë¦¼/ì¶œì„/ìƒë‹´</span>
            </div>
        </div>

        <div style="display:flex; align-items:center; gap:8px;">
            <label class="admin-switch" style="margin:0; cursor:pointer;">
                <input type="checkbox" id="adminToggle" onclick="toggleAdminMode()" style="width:auto; margin-right:6px;"> ì„ ìƒë‹˜
            </label>
            <button class="admin-only" onclick="document.getElementById('settingsModal').style.display='flex'"
                style="border:none; background:white; width:36px; height:36px; border-radius:50%; box-shadow:0 2px 5px rgba(0,0,0,0.1); color:#555;">
                <i class="fas fa-cog"></i>
            </button>
        </div>
    </header>
    <div class="tabs">
        <button class="tab-btn active" onclick="showPage('register')"><i class="fas fa-user-plus"></i> ì‹ ê·œ ë“±ë¡</button>
        <button class="tab-btn" onclick="showPage('list')"><i class="fas fa-users"></i> ì›ìƒ ê´€ë¦¬</button>
        <button class="tab-btn" onclick="showPage('calendar')"><i class="fas fa-calendar-alt"></i> í•™ìŠµ ì¼ì •</button>
        <button class="tab-btn admin-only" onclick="showPage('inbox')"><i class="fas fa-inbox"></i> í•™ë¶€ëª¨ ì˜ê²¬ <span id="inboxBadge" style="display:none; margin-left:6px; background:#ef4444; color:white; border-radius:999px; padding:2px 8px; font-size:12px; font-weight:900;">0</span></button>
    </div>

    <div id="register" class="page active">
        <div class="form-grid">
            <div class="full-width">
                <label>í•™ìƒ ì‚¬ì§„</label>
                <input type="file" id="regPhoto" accept="image/*">
            </div>
            <div>
                <label>ì´ë¦„</label>
                <input type="text" id="regName" placeholder="ì˜ˆ: ê¹€ìˆ˜í•™">
            </div>
            <div>
                <label>ìƒë…„ì›”ì¼</label>
                <input type="date" id="regBirth">
            </div>
            <div>
                <label>ì„±ë³„</label>
                <select id="regGender">
                    <option value="ë‚¨">ë‚¨ì</option>
                    <option value="ì—¬">ì—¬ì</option>
                </select>
            </div>
            <div>
                <label>í•™êµ</label>
                <input type="text" id="regSchool" placeholder="ì˜ˆ: ëŠ¥ë™ì´ˆ">
            </div>
            <div>
                <label>í•™ë…„/ê³¼ì •</label>
                <select id="regGrade">
                    <option value="ë¯¸ì·¨í•™">ë¯¸ì·¨í•™</option>
                    <option value="ì´ˆë“±1-2">ì´ˆë“± 1~2í•™ë…„</option>
                    <option value="ì´ˆë“±3-4">ì´ˆë“± 3~4í•™ë…„</option>
                    <option value="ì´ˆë“±5-6">ì´ˆë“± 5~6í•™ë…„</option>
                    <option value="ì¤‘ë“±ë¶€">ì¤‘ë“±ë¶€</option>
                    <option value="ê³ ë“±ë¶€">ê³ ë“±ë¶€</option>
                </select>
            </div>
            <div class="full-width" style="display:grid; grid-template-columns: 1fr 1fr; gap:10px;">
                <div>
                    <label style="color:var(--primary);">í•™ë¶€ëª¨ ì—°ë½ì²˜ (ì•Œë¦¼ìš©)</label>
                    <input type="tel" id="regParentPhone" placeholder="01012345678">
                </div>
                <div>
                    <label>í•™ìƒ ë³¸ì¸ ì—°ë½ì²˜</label>
                    <input type="tel" id="regStudentPhone" placeholder="01012345678">
                </div>
            </div>
            <div class="full-width">
                <label>ì£¼ì†Œ</label>
                <input type="text" id="regAddress" placeholder="ì£¼ì†Œë¥¼ ì…ë ¥í•˜ì„¸ìš”">
            </div>
            <div class="full-width">
                <label>í•™ìŠµ íŠ¹ì´ì‚¬í•­ (ì§„ë„, ì„±í–¥ ë“±)</label>
                <textarea id="regNotes" rows="3" placeholder="ìƒë‹´ ë° ì§€ë„ ì‹œ ì°¸ê³ í•  ì‚¬í•­"></textarea>
            </div>
        </div>
        <button class="action-btn" id="addBtn">í•™ìƒ ë“±ë¡í•˜ê¸°</button>
    </div>

  <div id="list" class="page">
        <div class="filter-container">
            <div class="filter-row">
                <span class="filter-label">ê³¼ì •</span>
                <div class="filter-group" id="ageFilterGroup">
                    <div class="filter-chip active" onclick="setGradeFilter('all', this)">ì „ì²´</div>
                    <div class="filter-chip" onclick="setGradeFilter('ë¯¸ì·¨í•™', this)">ë¯¸ì·¨í•™</div>
                    <div class="filter-chip" onclick="setGradeFilter('ì´ˆë“±', this)">ì´ˆë“±ë¶€</div>
                    <div class="filter-chip" onclick="setGradeFilter('ì¤‘ë“±', this)">ì¤‘ë“±ë¶€</div>
                    <div class="filter-chip" onclick="setGradeFilter('ê³ ë“±', this)">ê³ ë“±ë¶€</div>
                </div>
            </div>
            <div class="filter-row">
                <span class="filter-label">ê²€ìƒ‰</span>
                <input type="text" id="searchKeyword" placeholder="ì´ë¦„ ê²€ìƒ‰" onkeyup="filterList()" style="flex:1;">
                <select id="schoolFilter" onchange="filterList()" style="width: auto; flex:1;">
                    <option value="all">ì „ì²´ í•™êµ</option>
                </select>
            </div>
        </div>

        <div id="studentListArea">ë¡œë”©ì¤‘...</div>
    </div>


<div id="calendar" class="page">
    <div class="calendar-controls">
        <button class="cal-btn" onclick="changeCalDate(-1)"><i class="fas fa-chevron-left"></i></button>
        <div class="current-date" id="calTitle"></div>
        <button class="cal-btn" onclick="changeCalDate(1)"><i class="fas fa-chevron-right"></i></button>
    </div>

    <div class="filter-group" style="justify-content:center; margin-bottom:10px;">
        <label><input type="checkbox" id="showSchedule" checked onchange="renderCalendar()"> í•™ì›ì¼ì •</label> &nbsp;
        <label><input type="checkbox" id="showBirthday" checked onchange="renderCalendar()"> ìƒì¼</label>
    </div>

    <div class="calendar-grid">
        <div class="day-name" style="color:var(--danger)">ì¼</div><div class="day-name">ì›”</div><div class="day-name">í™”</div>
        <div class="day-name">ìˆ˜</div><div class="day-name">ëª©</div><div class="day-name">ê¸ˆ</div><div class="day-name" style="color:var(--primary)">í† </div>
    </div>
    <div class="calendar-grid" id="calGrid"></div>

<div id="dateDetailArea" style="margin-top:20px;">
        <div class="view-mode-group">
            <button class="view-mode-btn active" onclick="changeListView('day', this)">ì¼ê°„</button>
            <button class="view-mode-btn" onclick="changeListView('week', this)">ì£¼ê°„</button>
            <button class="view-mode-btn" onclick="changeListView('month', this)">ì›”ê°„</button>
            <button class="view-mode-btn" onclick="changeListView('year', this)">ì—°ê°„</button>
        </div>

        <h3 id="selectedDateText" style="font-size:15px; margin-bottom:10px; border-bottom:2px solid var(--primary); padding-bottom:5px; display:flex; justify-content:space-between; align-items:center;">
            <span>ë‚ ì§œë¥¼ ì„ íƒí•˜ì„¸ìš”</span>
            <button class="action-btn admin-only" id="addSchedBtn" onclick="openScheduleModal()" style="width:auto; margin:0; padding:5px 10px; font-size:12px; display:none;">+ ì¼ì • ë“±ë¡</button>
        </h3>

        <div id="dailyEventList" style="max-height:300px; overflow-y:auto;"></div>
    </div>
</div>

<!-- ===========================
     í•™ë¶€ëª¨ ì˜ê²¬í•¨ (ì„ ìƒë‹˜ ì „ìš©)
     =========================== -->
<div id="inbox" class="page">
    <div class="card" style="margin-top:10px;">
        <h3 style="margin:0 0 6px 0;">ğŸ“¨ í•™ë¶€ëª¨ ì˜ê²¬í•¨</h3>
        <div style="font-size:13px; color:#64748b; line-height:1.5;">
            í•™ë¶€ëª¨ê°€ <b>parent.html</b>ì—ì„œ ë³´ë‚¸ ë©”ì‹œì§€ê°€ ì—¬ê¸° ëª¨ì…ë‹ˆë‹¤.
            <br>ê° ë©”ì‹œì§€ì—ì„œ <b>í•™ìƒ ì—´ê¸°</b>ë¥¼ ëˆŒëŸ¬ ë°”ë¡œ í•´ë‹¹ í•™ìƒ ìƒì„¸ë¡œ ì´ë™í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
        </div>
    </div>
    <div class="card">
        <div id="inboxList" style="max-height:520px; overflow-y:auto;"></div>
    </div>
</div>

<div class="modal-overlay" id="scheduleModal">
    <div class="modal" style="max-width:340px;">
        <h3 id="schedModalTitle" style="margin-top:0;">ğŸ“… ì¼ì • ê´€ë¦¬</h3>

        <div style="margin-bottom:15px;">
            <label style="margin-bottom:5px;">ë“±ë¡ëœ ì¼ì •</label>
            <div id="popupSchedList" style="background:#f1f5f9; padding:10px; border-radius:8px; min-height:50px; max-height:120px; overflow-y:auto; font-size:13px;">
                </div>
        </div>

        <hr style="border:0; border-top:1px dashed #ddd; margin:15px 0;">

        <label>ë‚ ì§œ ì„ íƒ</label>
        <input type="date" id="schedDate" style="margin-bottom:10px;">

        <label>ì¼ì • ë‚´ìš©</label>
        <input type="hidden" id="schedId"> <input type="text" id="schedTitle" placeholder="ìƒˆ ë‚´ìš©ì„ ì…ë ¥í•˜ê±°ë‚˜ ìœ„ ëª©ë¡ì„ í´ë¦­" style="margin-bottom:15px;">

        <div class="modal-btn-group" style="display:flex; gap:8px;">
            <button class="action-btn" onclick="saveSchedule()" style="margin:0; flex:2;">ì €ì¥/ì¶”ê°€</button>
            <button class="action-btn" onclick="deleteSchedule()" id="btnDelSched" style="margin:0; flex:1; background:var(--danger); display:none;">ì‚­ì œ</button>
            <button class="action-btn" onclick="document.getElementById('scheduleModal').style.display='none'" style="margin:0; flex:1; background:#94a3b8;">ë‹«ê¸°</button>
        </div>
    </div>
</div>

      <div class="modal-overlay" id="detailModal">
    <div class="modal">
        <button class="close-btn" onclick="closeModal()">Ã—</button>

        <div class="modal-header-fixed">
            <div style="text-align:center;">
                <div style="width:70px; height:70px; margin:0 auto 10px; position:relative;" onclick="triggerPhotoEdit()">
                    <img id="modalImg" src="" style="width:100%; height:100%; border-radius:24px; object-fit:cover; border:1px solid #e2e8f0; box-shadow:0 4px 10px rgba(0,0,0,0.05);">
                    <div class="admin-only" style="position:absolute; bottom:-5px; right:-5px; background:#3b82f6; color:white; width:24px; height:24px; line-height:24px; text-align:center; border-radius:50%; font-size:12px; box-shadow:0 2px 5px rgba(0,0,0,0.2);">
                        <i class="fas fa-camera"></i>
                    </div>
                </div>
                <h2 id="modalName" style="margin:0 0 4px 0; font-size:18px; color:#1e293b;"></h2>
                <div id="modalInfo" style="color:#64748b; font-size:13px; margin-bottom:12px;"></div>

                <div class="contact-row" style="margin-bottom:5px;">
                    <div class="contact-group">
                        <span class="contact-label" style="font-size:11px; color:#94a3b8; margin-right:4px;">í•™ìƒ</span>
                        <a id="linkCallStu" class="contact-btn btn-call" style="width:32px; height:32px; font-size:13px;"><i class="fas fa-phone"></i></a>
                        <a id="linkSmsStu" class="contact-btn btn-sms" style="width:32px; height:32px; font-size:13px;"><i class="fas fa-comment-dots"></i></a>
                        <a id="linkKakaoStu" class="contact-btn btn-kakao" onclick="sendKakaoToTarget('student')" style="width:32px; height:32px; font-size:13px;"><i class="fas fa-comment"></i></a>
                    </div>
                    <div style="width:1px; height:15px; background:#e2e8f0; margin:0 5px;"></div>
                    <div class="contact-group">
                        <span class="contact-label" style="font-size:11px; color:#94a3b8; margin-right:4px;">ë¶€ëª¨</span>
                        <a id="linkCallPar" class="contact-btn btn-call" style="width:32px; height:32px; font-size:13px;"><i class="fas fa-phone"></i></a>
                        <a id="linkSmsPar" class="contact-btn btn-sms" style="width:32px; height:32px; font-size:13px;"><i class="fas fa-comment-dots"></i></a>
                        <a id="linkKakaoPar" class="contact-btn btn-kakao" onclick="sendKakaoToTarget('parent')" style="width:32px; height:32px; font-size:13px;"><i class="fas fa-comment"></i></a>
                    </div>
                </div>
                <input type="file" id="editPhotoInput" accept="image/*" style="display:none;" onchange="previewEditPhoto()">
            </div>
        </div>

        <div class="modal-tab-nav" style="margin-top:10px;">
            <button class="modal-tab-btn active" onclick="switchModalTab('tabDaily', this)">ğŸ“‹ í•™ìŠµ/ì¶œì„</button>
            <button class="modal-tab-btn" onclick="switchModalTab('tabScore', this)">ğŸ“ˆ ì„±ì /ê¸°ë¡</button>
            <button class="modal-tab-btn" onclick="switchModalTab('tabInfo', this)">âš™ï¸ ì •ë³´/ì •ì‚°</button>
        </div>

        <div class="modal-body-scroll">

            <div id="tabDaily" class="modal-tab-pane active">
    <div class="stat-box" style="margin: 0 0 15px 0; background:white;">
        <div class="stat-item"><div class="stat-num" id="statMonth">0íšŒ</div><div style="font-size:12px; color:#64748b;">ì´ë²ˆë‹¬ ë“±ì›</div></div>
        <div style="width:1px; height:30px; background:#eee;"></div>
        <div class="stat-item"><div class="stat-num" id="statTotal">0íšŒ</div><div style="font-size:12px; color:#64748b;">ì´ ëˆ„ì  ë“±ì›</div></div>
    </div>

    <div class="info-box" style="background:#fffbeb; border-color:#fcd34d;">
        <h4 style="color:#d97706; border-color:#fde68a;"><i class="fas fa-bullhorn"></i> ì˜¤ëŠ˜ì˜ ì•Œë¦¼ì¥ (í•™ë¶€ëª¨ ì „ì†¡)</h4>

        <textarea id="dailyProgress" rows="3" placeholder="ì˜¤ëŠ˜ ê³µë¶€í•œ ë‚´ìš©ì´ë‚˜ ì „ë‹¬ì‚¬í•­ì„ ì…ë ¥í•˜ì„¸ìš”." style="background:white; border:1px solid #fde68a; margin-bottom:8px;"></textarea>

        <div id="noticePreview" style="display:none; background:white; padding:10px; border:1px solid #fcd34d; font-size:13px; white-space:pre-wrap; margin-bottom:8px; color:#333; border-radius:6px;"></div>

        <div class="modal-action-row" style="display:grid; grid-template-columns: 1fr 1fr 1fr; gap:8px;">
            <button class="action-btn" onclick="generateNotice()" style="background:#f59e0b; margin:0; font-size:13px; padding:12px 0;">ğŸ“ ë¬¸êµ¬ ìƒì„±</button>
            <button class="action-btn" onclick="sendNoticeSms()" style="background:#22c55e; margin:0; font-size:13px; padding:12px 0;"><i class="fas fa-envelope"></i> ë¬¸ì</button>
            <button class="action-btn" onclick="sendNoticeKakao()" style="background:#fee500; color:#3c1e1e; margin:0; font-size:13px; padding:12px 0;"><i class="fas fa-comment"></i> ì¹´í†¡</button>
        </div>
    </div>
</div>

            <div id="tabScore" class="modal-tab-pane">
                <div class="info-box">
                    <h4>ğŸ’¬ ìƒë‹´ ë° ì§€ë„ ê¸°ë¡</h4>
                    <div class="admin-only" style="display:flex; gap:6px; margin-bottom:10px;">
                        <input type="text" id="newCounsel" placeholder="ìƒë‹´ ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”" style="flex:1;">
                        <button class="action-btn" onclick="addCounselLog()" style="width:60px; margin:0; background:#3b82f6;">ë“±ë¡</button>
                    </div>
                    <div id="modalCounselLog" style="max-height:150px; overflow-y:auto; border:1px solid #f1f5f9; background:#f8fafc; padding:10px; border-radius:8px;"></div>
                </div>

                <div class="info-box">
                    <h4 style="display:flex; justify-content:space-between; align-items:center;">
                        ğŸ“ˆ ì„±ì  ê´€ë¦¬
                        <button onclick="document.getElementById('scoreInputArea').style.display = document.getElementById('scoreInputArea').style.display=='none'?'block':'none'" style="font-size:11px; padding:4px 8px; border:1px solid #ddd; background:#fff; border-radius:4px; cursor:pointer;">ì…ë ¥ì°½ ì—´ê¸°</button>
                    </h4>

                    <div id="scoreInputArea" class="admin-only" style="display:none; background:#f1f5f9; padding:10px; border-radius:8px; margin-bottom:10px;">
                        <div class="score-input-group" style="display:flex; gap:5px;">
                            <input type="text" id="scoreTitle" placeholder="ì‹œí—˜ëª…(ì˜ˆ: 3ì›”ëª¨ì˜)" style="flex:2;">
                            <input type="number" id="scoreValue" placeholder="ì ìˆ˜" style="flex:1;">
                            <button onclick="addScore()" style="background:#7b1fa2; color:white; border:none; border-radius:6px; width:50px;">ì¶”ê°€</button>
                        </div>
                    </div>

                    <div class="chart-container" style="height:180px; margin-bottom:10px;">
                        <canvas id="scoreChart"></canvas>
                    </div>
                    <div id="scoreList" style="max-height:120px; overflow-y:auto; font-size:12px;"></div>
                </div>
            </div>

            <div id="tabInfo" class="modal-tab-pane">

                <div class="info-box" style="background:#f0f9ff; border-color:#bae6fd;">
                    <h4 style="color:#0369a1; border-color:#e0f2fe;"><i class="fas fa-file-invoice-dollar"></i> êµìœ¡ë¹„ ì •ì‚° ì•ˆë‚´</h4>
                    <div style="font-size:12px; color:#555; margin-bottom:8px;">
                        ì´ë²ˆ ë‹¬ ì¶œì„ì¼ìˆ˜ì™€ ì•ˆë‚´ ë¬¸êµ¬ë¥¼ ìë™ìœ¼ë¡œ ìƒì„±í•©ë‹ˆë‹¤.
                    </div>
                    <div id="settlementPreview" style="background:white; padding:10px; border:1px solid #bae6fd; font-size:12px; white-space:pre-wrap; margin-bottom:8px; color:#333; min-height:60px; border-radius:6px;"></div>
                    <div class="modal-action-row" style="display:flex; gap:8px;">
                        <button onclick="generateSettlement()" class="action-btn" style="flex:1; background:#0ea5e9; font-size:13px; margin:0;">ë¬¸êµ¬ ìƒì„±</button>
                        <button onclick="copyText('settlementPreview')" class="action-btn" style="flex:1; background:#0284c7; font-size:13px; margin:0;">ë‚´ìš© ë³µì‚¬</button>
                    </div>
                </div>

                <div class="info-box admin-only">
                    <h4>âš™ï¸ í•™ìƒ ì •ë³´ ìˆ˜ì •</h4>

                    <div id="modalEditForm">
                        <input type="hidden" id="editId">

                        <div class="full-row">
                            <label>ì´ë¦„</label>
                            <input type="text" id="editName">
                        </div>

                        <div>
                            <label>í•™êµ</label>
                            <input type="text" id="editSchool">
                        </div>
                        <div>
                            <label>í•™ë…„/ê³¼ì •</label>
                            <select id="editGrade">
                                <option value="ë¯¸ì·¨í•™">ë¯¸ì·¨í•™</option><option value="ì´ˆë“±1-2">ì´ˆë“± 1~2í•™ë…„</option>
                                <option value="ì´ˆë“±3-4">ì´ˆë“± 3~4í•™ë…„</option><option value="ì´ˆë“±5-6">ì´ˆë“± 5~6í•™ë…„</option>
                                <option value="ì¤‘ë“±ë¶€">ì¤‘ë“±ë¶€</option><option value="ê³ ë“±ë¶€">ê³ ë“±ë¶€</option>
                            </select>
                        </div>

                        <div>
                            <label>ìƒë…„ì›”ì¼</label>
                            <input type="date" id="editBirth">
                        </div>
                        <div>
                            <label>ì„±ë³„</label>
                            <select id="editGender"><option value="ë‚¨">ë‚¨</option><option value="ì—¬">ì—¬</option></select>
                        </div>

                        <div class="full-row">
                            <label>ë¶€ëª¨ë‹˜ ì—°ë½ì²˜</label>
                            <input type="tel" id="editParentPhone">
                        </div>
                        <div class="full-row">
                            <label>í•™ìƒ ì—°ë½ì²˜</label>
                            <input type="tel" id="editStudentPhone">
                        </div>
                        <div class="full-row">
                            <label>íŠ¹ì´ì‚¬í•­ (ë©”ëª¨)</label>
                            <textarea id="editNotes" rows="2"></textarea>
                        </div>
                    </div>

                    <div class="modal-action-row" style="margin-top:15px; display:flex; gap:10px;">
                        <button class="action-btn" onclick="saveEdit()" style="background:#3b82f6; margin:0; flex:2;">ì €ì¥í•˜ê¸°</button>
                        <button class="action-btn" onclick="deleteStudent()" style="background:#ef4444; margin:0; flex:1;">ì‚­ì œ</button>
                    </div>
                </div>

            </div> </div> </div>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getFirestore, collection, getDocs, query, where, addDoc, serverTimestamp, doc, onSnapshot, updateDoc, deleteDoc, arrayUnion, orderBy, setDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

    const firebaseConfig = {
        apiKey: "AIzaSyDPLl5y5xMBL07yLyQDU185qfYLa4c3yv4",
        authDomain: "namyang-f3a98.firebaseapp.com",
        projectId: "namyang-f3a98",
        storageBucket: "namyang-f3a98.firebasestorage.app",
        messagingSenderId: "641432133626",
        appId: "1:641432133626:web:4d31e36d5dbb0db4df4e43",
        measurementId: "G-23L6KZERMF"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    // ================================
    // ì „í™”ë²ˆí˜¸ ì •ê·œí™”(í•˜ì´í”ˆ/ê³µë°± ì œê±°)
    // ================================
    const normalizePhone = (v) => (v || '').toString().replace(/\D/g, '');


    // ==========================================
    // 1. SMS ì„œë²„ ì„¤ì • (ìë™ ë¬¸ììš©)
    // ==========================================
    const SMS_CLIENT_KEY = "CHANGE_ME_TO_A_LONG_RANDOM_STRING"; // ì‹¤ì œ í‚¤ê°€ ìˆë‹¤ë©´ ë³€ê²½í•˜ì„¸ìš”
    const SMS_API_URL = "/api/send-sms";

    async function sendSmsByServer(receiver, msg) {
      try {
          const res = await fetch(SMS_API_URL, {
            method: "POST",
            headers: { "Content-Type": "application/json", "x-api-key": SMS_CLIENT_KEY },
            body: JSON.stringify({ receiver, msg })
          });
          const data = await res.json().catch(async () => ({ raw: await res.text() }));
          return { ok: data.success === true || data.result_code === "1", data };
      } catch (e) {
          console.error("SMS ë°œì†¡ ì‹¤íŒ¨:", e);
          return { ok: false, error: e };
      }
    }

    // ==========================================
    // 2. ì „ì—­ ë³€ìˆ˜ ë° ìƒíƒœ ê´€ë¦¬
    // ==========================================
    window.allStudents = [];
    window.allSchedules = [];
    window.currentStudentId = null;
    let selectedStudentIds = new Set();
    let selectedDateStr = new Date().toISOString().slice(0, 10);
    let currentGradeFilter = 'all';
    let currentKioskCategory = 'all';
    let calDate = new Date();
    let myChart = null;

    // ëª¨ë“œ ì„¤ì • (localStorage)
    const LS_TEACHER = 'teacherMode';
    const LS_KIOSK = 'kioskMode';

    function isTeacherMode(){ return localStorage.getItem(LS_TEACHER) === '1'; }
    function setTeacherMode(on){
        if(on) localStorage.setItem(LS_TEACHER,'1');
        else localStorage.removeItem(LS_TEACHER);
    }
    function isKioskSaved(){ return localStorage.getItem(LS_KIOSK) === '1'; }
    function setKioskSaved(on){
        if(on) localStorage.setItem(LS_KIOSK,'1');
        else localStorage.removeItem(LS_KIOSK);
    }

    function applyAccessUI(){
        const teacher = isTeacherMode();
        const kiosk = document.body.classList.contains('kiosk-mode');

        // ì„ ìƒë‹˜ ëª¨ë“œ CSS ì ìš©
        document.body.classList.toggle('show-admin', teacher && !kiosk);
        const chk = document.getElementById('adminToggle');
        if(chk) chk.checked = teacher;

        // íƒ­ ë²„íŠ¼ ì œì–´ (ì„ ìƒë‹˜ ì•„ë‹ˆë©´ ì›ìƒê´€ë¦¬ ë“± ìˆ¨ê¹€)
        document.querySelectorAll('.tab-btn').forEach(btn => {
            const oc = btn.getAttribute('onclick') || '';
            const restricted = oc.includes("showPage('register')") || oc.includes("showPage('list')") || oc.includes("showPage('inbox')");
            if(!teacher && !kiosk && restricted) btn.style.display = 'none';
            else btn.style.display = '';
        });

        // í‚¤ì˜¤ìŠ¤í¬ ì‹œì‘ ë²„íŠ¼ ë³´ì´ê¸°/ìˆ¨ê¸°ê¸°
        const kBtn = document.getElementById('btnKioskStart'); // ë§Œì•½ ë²„íŠ¼ IDê°€ ìˆë‹¤ë©´
        if(kBtn) kBtn.style.display = (teacher && !kiosk) ? 'inline-block' : 'none';
    }

    // ==========================================
    // 3. ë°ì´í„° ì‹¤ì‹œê°„ ë™ê¸°í™”
    // ==========================================

    // í•™ìƒ ë°ì´í„° ë¡œë“œ
    onSnapshot(collection(db, "students"), (snapshot) => {
        window.allStudents = [];
        snapshot.forEach((doc) => { window.allStudents.push({ id: doc.id, ...doc.data() }); });

        updateSchoolOptions();
        filterList();
        if(window.renderCalendar) window.renderCalendar();

        // ìƒì„¸ì°½ì´ ì—´ë ¤ìˆë‹¤ë©´ ë‚´ìš© ê°±ì‹ 
        if(document.getElementById('detailModal').style.display === 'flex' && window.currentStudentId) {
            const s = window.allStudents.find(st => st.id === window.currentStudentId);
            if(s) window.openDetail(s);
        }
    });

    // ì¼ì • ë°ì´í„° ë¡œë“œ
    onSnapshot(query(collection(db, "schedules"), orderBy("date")), (snapshot) => {
        window.allSchedules = [];
        snapshot.forEach((doc) => { window.allSchedules.push({ id: doc.id, ...doc.data() }); });
        if(window.renderCalendar) window.renderCalendar();
    });

    // ==========================================
    // 4. ë¦¬ìŠ¤íŠ¸ ë° ì¹´ë“œ ìƒì„± (ê¸°ëŠ¥ ë³µêµ¬ë¨)
    // ==========================================
    window.filterList = () => {
        const searchInput = document.getElementById('searchKeyword');
        let keyword = (searchInput && !document.body.classList.contains('kiosk-mode')) ? searchInput.value.toLowerCase() : "";
        const schoolFilter = document.getElementById('schoolFilter') ? document.getElementById('schoolFilter').value : 'all';
        const todayStr = new Date().toDateString();
        const isKiosk = document.body.classList.contains('kiosk-mode');

        let filtered = window.allStudents.filter(s => {
            const sName = s.name ? s.name.toLowerCase() : "";
            const sBelt = s.belt || "";

            if (isKiosk) {
                if (currentKioskCategory === 'all') return true;
                return sBelt.includes(currentKioskCategory);
            } else {
                const matchName = sName.includes(keyword);
                const matchSchool = schoolFilter === 'all' || s.school === schoolFilter;
                const matchGrade = currentGradeFilter === 'all' || sBelt === currentGradeFilter;
                return matchName && matchSchool && matchGrade;
            }
        });

        filtered.sort((a, b) => a.name.localeCompare(b.name));

        const listArea = document.getElementById('studentListArea');
        listArea.innerHTML = "";

        if(filtered.length === 0) {
            listArea.innerHTML = "<div style='text-align:center; padding:20px; color:#999; width:100%;'>ê²€ìƒ‰ëœ ì›ìƒì´ ì—†ìŠµë‹ˆë‹¤.</div>";
            return;
        }

        filtered.forEach(s => {
            const imgSrc = s.photo || "https://via.placeholder.com/150?text=NO+IMAGE";
            const hasArrived = (s.attendanceLog || []).some(log => new Date(log.seconds ? log.seconds*1000 : log).toDateString() === todayStr);
            const hasLeft = (s.attendanceOutLog || []).some(log => new Date(log.seconds ? log.seconds*1000 : log).toDateString() === todayStr);

            const div = document.createElement('div');
            div.id = `card-${s.id}`;
            const stateClass = hasLeft ? 'left' : (hasArrived ? 'arrived' : 'missing');

            if (isKiosk) {
                // [í‚¤ì˜¤ìŠ¤í¬] ì¹´ë“œ
                const pillText = hasLeft ? 'í•˜ì› ì™„ë£Œ' : (hasArrived ? 'ë“±ì› ì™„ë£Œ' : 'ë¯¸ë“±ì›');
                const hint = hasLeft ? 'ì™„ë£Œ ìƒíƒœ' : (hasArrived ? '<strong>í•œ ë²ˆ ë” íƒ­</strong>í•˜ë©´ í•˜ì› ì²˜ë¦¬' : '<strong>í•œ ë²ˆ íƒ­</strong>í•˜ë©´ ë“±ì› ì²˜ë¦¬');
                div.className = `student-card ${stateClass}`;
                div.innerHTML = `
                    <div class="kiosk-pill ${stateClass}">${pillText}</div>
                    <div class="profile-wrapper"><img src="${imgSrc}" class="profile-img"></div>
                    <div class="info-area">
                        <div>${s.name}</div>
                        <small>${s.school || 'í•™êµë¯¸ì…ë ¥'} | <span style="font-weight:900;">${s.belt || 'í•™ë…„ì—†ìŒ'}</span></small>
                    </div>
                    <div class="kiosk-hint">${hint}</div>
                `;
                div.onclick = () => window.kioskTapAttendance(s.id);
            } else {
                // [ì„ ìƒë‹˜] ì¹´ë“œ
                div.className = `student-card ${stateClass}`;
                div.innerHTML = `
                    <div class="profile-wrapper" style="width:55px; height:55px; margin:0;"><img src="${imgSrc}" class="profile-img" style="border-radius:18px;"></div>
                    <div class="info-area" style="text-align:left; padding-left:15px;">
                        <div><strong style="color:#333; font-size:16px;">${s.name}</strong> <span class="dept-badge">${s.belt || ''}</span></div>
                        <div style="font-size:13px; color:#777; margin-top:4px;">${s.school || ''}</div>
                    </div>
                `;
                div.onclick = () => window.openDetail(s);
            }
            listArea.appendChild(div);
        });
    };

    // ==========================================
    // 5. ìƒì„¸ íŒì—… ë° ë°ì´í„° ê´€ë¦¬
    // ==========================================
    window.openDetail = (s) => {
        window.currentStudentId = s.id;
        const modal = document.getElementById('detailModal');
        modal.style.display = 'flex';
        try { modal.querySelector('.modal').classList.add('modal-full'); } catch(e) {}

        // ê¸°ë³¸ì •ë³´
        document.getElementById('modalImg').src = s.photo || "https://via.placeholder.com/150";
        document.getElementById('modalName').innerText = s.name;
        document.getElementById('modalInfo').innerText = `${s.school||''} | ${s.belt||''}`;

        // ì—°ë½ì²˜ ì—°ê²°
        const stuPhone = (s.studentPhone || "").replace(/[^0-9]/g, '');
        const parPhone = (s.phone || "").replace(/[^0-9]/g, '');
        document.getElementById('linkCallStu').href = stuPhone ? `tel:${stuPhone}` : "#";
        document.getElementById('linkSmsStu').href = stuPhone ? `sms:${stuPhone}` : "#";
        document.getElementById('linkCallPar').href = parPhone ? `tel:${parPhone}` : "#";
        document.getElementById('linkSmsPar').href = parPhone ? `sms:${parPhone}` : "#";

        // ìˆ˜ì • í¼ ì±„ìš°ê¸°
        document.getElementById('editId').value = s.id;
        document.getElementById('editName').value = s.name || "";
        document.getElementById('editSchool').value = s.school || "";
        document.getElementById('editGrade').value = s.belt || "ë¯¸ì·¨í•™";
        document.getElementById('editBirth').value = s.birth || "";
        document.getElementById('editGender').value = s.gender || "ë‚¨";
        document.getElementById('editParentPhone').value = s.phone || "";
        document.getElementById('editStudentPhone').value = s.studentPhone || "";
        document.getElementById('editNotes').value = s.notes || "";

        // ê¸°ë¡ ë° ì°¨íŠ¸ ë¡œë“œ
        if(window.renderScoreChart) window.renderScoreChart(s.scoreLog || []);
        window.renderCounselLog(s);
        window.calcStats(s);

        // ì…ë ¥ì°½ ì´ˆê¸°í™”
        document.getElementById('dailyProgress').value = "";
        document.getElementById('noticePreview').innerText = "";
        document.getElementById('noticePreview').style.display = 'none';
        document.getElementById('settlementPreview').innerText = "";
    };

    window.openDetailById = (id) => {
        const s = window.allStudents.find(st => st.id === id);
        if(s) window.openDetail(s);
    };

    window.closeModal = () => {
        document.getElementById('detailModal').style.display = 'none';
        window.currentStudentId = null;
    };

    // ì°¨íŠ¸
    window.renderScoreChart = (scoreLog) => {
        const ctx = document.getElementById('scoreChart').getContext('2d');
        if (myChart) myChart.destroy();

        myChart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: scoreLog.map(s => s.title),
                datasets: [{
                    label: 'ì„±ì ', data: scoreLog.map(s => s.score),
                    borderColor: '#3b82f6', backgroundColor: 'rgba(59,130,246,0.1)', fill: true, tension: 0.3
                }]
            },
            options: { responsive: true, plugins: { legend: { display: false } }, scales: { y: { min: 0, max: 100 } } }
        });

        const list = document.getElementById('scoreList');
        if(list) list.innerHTML = scoreLog.map((s, i) => `
            <div style="padding:8px; border-bottom:1px solid #eee; display:flex; justify-content:space-between;">
                <span>${s.title} (${s.date})</span>
                <div>
                    <strong style="color:#3b82f6;">${s.score}ì </strong>
                    <i class="fas fa-trash admin-only" onclick="deleteScore(${i})" style="color:red; cursor:pointer; margin-left:8px;"></i>
                </div>
            </div>`).reverse().join('');
    };

    // ìƒë‹´ ê¸°ë¡
    window.renderCounselLog = (s) => {
        const list = document.getElementById('modalCounselLog');
        if(!list) return;
        const logs = s.counselLog || [];
        list.innerHTML = logs.length ? logs.map((l, i) => `
            <div style="padding:8px; background:white; margin-bottom:5px; border-radius:5px; border:1px solid #eee;">
                <span style="color:#009688;">[${l.date}]</span> ${l.text}
                <i class="fas fa-trash admin-only" onclick="deleteCounselLog(${i})" style="float:right; color:red; cursor:pointer;"></i>
            </div>`).reverse().join('') : "<div style='text-align:center; padding:10px; color:#999;'>ê¸°ë¡ ì—†ìŒ</div>";
    };

    // [CRUD ê¸°ëŠ¥] - ì¶”ê°€/ìˆ˜ì •/ì‚­ì œ
    window.addScore = async () => {
        const title = document.getElementById('scoreTitle').value;
        const score = document.getElementById('scoreValue').value;
        if(!title || !score) return;
        await updateDoc(doc(db, "students", window.currentStudentId), {
            scoreLog: arrayUnion({ date: new Date().toLocaleDateString(), title, score })
        });
        document.getElementById('scoreTitle').value = ""; document.getElementById('scoreValue').value = "";
    };
    window.deleteScore = async (idx) => {
        if(!confirm("ì‚­ì œí•©ë‹ˆê¹Œ?")) return;
        const s = window.allStudents.find(st => st.id === window.currentStudentId);
        const newLog = s.scoreLog.filter((_, i) => i !== idx);
        await updateDoc(doc(db, "students", window.currentStudentId), { scoreLog: newLog });
    };

    window.addCounselLog = async () => {
        const text = document.getElementById('newCounsel').value;
        if(!text) return;
        await updateDoc(doc(db, "students", window.currentStudentId), {
            counselLog: arrayUnion({ date: new Date().toLocaleDateString(), text })
        });
        document.getElementById('newCounsel').value = "";
        window.renderCounselLog(window.allStudents.find(st => st.id === window.currentStudentId)); // ì¦‰ì‹œ ê°±ì‹ 
    };
    window.deleteCounselLog = async (idx) => {
        if(!confirm("ì‚­ì œí•©ë‹ˆê¹Œ?")) return;
        const s = window.allStudents.find(st => st.id === window.currentStudentId);
        const newLog = s.counselLog.filter((_, i) => i !== idx);
        await updateDoc(doc(db, "students", window.currentStudentId), { counselLog: newLog });
    };

    window.saveEdit = async () => {
        try {
            await updateDoc(doc(db, "students", document.getElementById('editId').value), {
                name: document.getElementById('editName').value,
                school: document.getElementById('editSchool').value,
                belt: document.getElementById('editGrade').value,
                phone: normalizePhone(document.getElementById('editParentPhone').value),
                studentPhone: normalizePhone(document.getElementById('editStudentPhone').value),
                notes: document.getElementById('editNotes').value
            });
            alert("ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.");
        } catch(e) { alert("ì˜¤ë¥˜: "+e.message); }
    };
    window.deleteStudent = async () => {
        if(confirm("ì •ë§ ì‚­ì œí•©ë‹ˆê¹Œ? ë³µêµ¬ ë¶ˆê°€!")) {
            await deleteDoc(doc(db, "students", window.currentStudentId));
            window.closeModal();
        }
    };

    // ì‹ ê·œ ë“±ë¡ ë¡œì§
    const addBtn = document.getElementById('addBtn');
    if(addBtn) {
        addBtn.onclick = async () => {
            const name = document.getElementById('regName').value;
            if(!name) return alert("ì´ë¦„ í•„ìˆ˜");

            // ì‚¬ì§„ ì²˜ë¦¬
            let photoUrl = "";
            const file = document.getElementById('regPhoto').files[0];
            if(file) photoUrl = await resizeImage(file);

            await addDoc(collection(db, "students"), {
                name,
                birth: document.getElementById('regBirth').value,
                gender: document.getElementById('regGender').value,
                school: document.getElementById('regSchool').value,
                belt: document.getElementById('regGrade').value,
                phone: normalizePhone(document.getElementById('regParentPhone').value),
                studentPhone: normalizePhone(document.getElementById('regStudentPhone').value),
                address: document.getElementById('regAddress').value,
                notes: document.getElementById('regNotes').value,
                photo: photoUrl,
                regDate: serverTimestamp(),
                attendanceLog:[], attendanceOutLog:[], scoreLog:[], counselLog:[]
            });
            alert("ë“±ë¡ ì™„ë£Œ");
            window.showPage('list');
            // ì…ë ¥ì°½ ì´ˆê¸°í™”
            document.querySelectorAll('#register input').forEach(i => i.value='');
        };
    }

    function resizeImage(file) {
        return new Promise(resolve => {
            const reader = new FileReader();
            reader.onload = e => {
                const img = new Image();
                img.onload = () => {
                    const cvs = document.createElement('canvas');
                    const scale = 250/img.width;
                    cvs.width = 250; cvs.height = img.height * scale;
                    cvs.getContext('2d').drawImage(img,0,0,cvs.width,cvs.height);
                    resolve(cvs.toDataURL('image/jpeg', 0.5));
                };
                img.src = e.target.result;
            };
            reader.readAsDataURL(file);
        });
    }

    // ==========================================
    // 6. ì•Œë¦¼ì¥, ì •ì‚°, ì¹´í†¡ ê³µìœ  (ê¸°ëŠ¥ ë³µêµ¬)
    // ==========================================
    window.generateNotice = () => {
        const s = window.allStudents.find(st => st.id === window.currentStudentId);
        const text = document.getElementById('dailyProgress').value;
        if(!text) { alert("ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”"); return ""; }

        const msg = `[ë¯¸ë˜ì—”ìˆ˜í•™] ì•Œë¦¼ì¥ ğŸ“¢\n\nì•ˆë…•í•˜ì„¸ìš”, í•™ë¶€ëª¨ë‹˜!\nì˜¤ëŠ˜ ${s.name} í•™ìƒ í•™ìŠµ ë‚´ìš©ì…ë‹ˆë‹¤.\n\nğŸ“š í•™ìŠµë‚´ìš©\n${text}\n\nê°ì‚¬í•©ë‹ˆë‹¤.`;
        const box = document.getElementById('noticePreview');
        if(box) { box.innerText = msg; box.style.display = 'block'; }
        return msg;
    };

    // [Manual SMS] ë²„íŠ¼: íœ´ëŒ€í° ì•± ì—´ê¸°
    window.sendNoticeSms = () => {
        const s = window.allStudents.find(st => st.id === window.currentStudentId);
        if(!s.phone) return alert("ë¶€ëª¨ë‹˜ ì—°ë½ì²˜ ì—†ìŒ");
        const msg = window.generateNotice();
        if(msg) location.href = `sms:${s.phone.replace(/-/g,'')}?body=${encodeURIComponent(msg)}`;
    };

    // [Kakao] ë²„íŠ¼: ë§í¬ ìƒì„± ë° ê³µìœ 
    window.sendNoticeKakao = async () => {
        const s = window.allStudents.find(st => st.id === window.currentStudentId);
        const text = document.getElementById('dailyProgress').value;
        if(!text) return alert("ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”");
        const parentUrl = location.origin + '/parent.html?v=' + Date.now();
        const msg = `[ë¯¸ë˜ì—”ìˆ˜í•™] ${s.name} í•™ìƒ ì•Œë¦¼ì¥\n\n${text}\n\nğŸ‘‡ í™•ì¸í•˜ê¸°\n${parentUrl}`;

        // DB ì €ì¥ (ì•Œë¦¼ì¥ ë‚´ìš© ê¸°ë¡)
        await updateDoc(doc(db, 'students', window.currentStudentId), {
            lastNotice: text,
            counselLog: arrayUnion({ date: new Date().toLocaleDateString(), text: '[ì•Œë¦¼ì¥] ' + text })
        });

        if (navigator.share) {
            try { await navigator.share({ title: 'ì•Œë¦¼ì¥', text: msg, url: parentUrl }); } catch(e){}
        } else {
            navigator.clipboard.writeText(msg).then(()=>alert("ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤. ì¹´í†¡ì— ë¶™ì—¬ë„£ìœ¼ì„¸ìš”."));
        }
    };
    window.sendKakaoToTarget = (target) => window.sendNoticeKakao();

    // [ì •ì‚°] ìë™ ë¬¸êµ¬ ìƒì„±
    window.generateSettlement = () => {
        const s = window.allStudents.find(st => st.id === window.currentStudentId);
        const m = new Date().getMonth() + 2;
        const nextM = m > 12 ? 1 : m;
        const msg = `[ë¯¸ë˜ì—”ìˆ˜í•™] êµìœ¡ë¹„ ì•ˆë‚´\n\nì•ˆë…•í•˜ì„¸ìš”. ${s.name} í•™ìƒì˜ ${nextM}ì›” êµìœ¡ë¹„ ì•ˆë‚´ì…ë‹ˆë‹¤.\nê¸°ê°„: ë§¤ì›” 1ì¼~10ì¼\nê³„ì¢Œ: ë†í˜‘ 000-0000-0000\n\nê°ì‚¬í•©ë‹ˆë‹¤.`;
        document.getElementById('settlementPreview').innerText = msg;
    };
    window.copyText = (id) => navigator.clipboard.writeText(document.getElementById(id).innerText).then(()=>alert("ë³µì‚¬ë¨"));

    // í†µê³„ ê³„ì‚°
    window.calcStats = (s) => {
        const logs = s.attendanceLog || [];
        const now = new Date();
        const monthLogs = logs.filter(ts => {
            const d = new Date(ts.seconds ? ts.seconds*1000 : ts);
            return d.getMonth() === now.getMonth();
        });
        document.getElementById('statTotal').innerText = logs.length + "íšŒ";
        document.getElementById('statMonth').innerText = monthLogs.length + "íšŒ";
    };

    // ==========================================
    // 7. í•™ë¶€ëª¨ ì˜ê²¬í•¨ (í†µí•©)
    // ==========================================
    const inboxListEl = document.getElementById('inboxList');
    if(inboxListEl) {
        onSnapshot(query(collection(db, "parentMessages"), orderBy("createdAt", "desc")), (snapshot) => {
            let unread = 0;
            let html = "";
            if(snapshot.empty) html = "<div style='padding:20px; text-align:center; color:#999;'>ë©”ì‹œì§€ê°€ ì—†ìŠµë‹ˆë‹¤.</div>";

            snapshot.forEach(doc => {
                const d = doc.data();
                if(!d.read) unread++;
                const bg = d.read ? "white" : "#fff7ed";
                html += `
                    <div style="background:${bg}; padding:15px; margin-bottom:10px; border:1px solid #eee; border-radius:10px;">
                        <div style="font-weight:bold; margin-bottom:5px; display:flex; justify-content:space-between;">
                            <span>${d.studentName} (${d.parentPhone})</span>
                            <div style="font-size:12px; font-weight:normal;">
                                <button onclick="openMessageStudent('${d.studentId}')" style="background:#3b82f6; color:white; border:none; border-radius:4px; padding:4px 8px; cursor:pointer;">í•™ìƒ ì—´ê¸°</button>
                                ${!d.read ? `<button onclick="markMessageRead('${doc.id}')" style="background:#10b981; color:white; border:none; border-radius:4px; padding:4px 8px; cursor:pointer;">ì½ìŒ</button>` : ''}
                            </div>
                        </div>
                        <div style="font-size:14px; color:#333; white-space:pre-wrap;">${d.message}</div>
                    </div>`;
            });
            inboxListEl.innerHTML = html;
            const badge = document.getElementById('inboxBadge');
            if(badge) {
                badge.style.display = unread > 0 ? 'inline-block' : 'none';
                badge.innerText = unread;
            }
        });
    }

    window.markMessageRead = async (id) => await updateDoc(doc(db, "parentMessages", id), { read: true });
    window.openMessageStudent = (sid) => {
        // ì„ ìƒë‹˜ ëª¨ë“œ ì¼œê³  ì´ë™
        if(!isTeacherMode()) window.toggleAdminMode(true);
        window.showPage('list');
        setTimeout(() => window.openDetailById(sid), 500);
    };

    // ==========================================
    // 8. ìº˜ë¦°ë” & ì¼ì •
    // ==========================================
    window.renderCalendar = () => {
        const y = calDate.getFullYear(), m = calDate.getMonth();
        document.getElementById('calTitle').innerText = `${y}ë…„ ${m+1}ì›”`;
        const grid = document.getElementById('calGrid');
        grid.innerHTML = "";

        let events = [];
        if(document.getElementById('showSchedule')?.checked) events = [...window.allSchedules.map(s => ({...s, type:'schedule'}))];
        if(document.getElementById('showBirthday')?.checked) {
            window.allStudents.forEach(s => {
                if(s.birth && s.birth.includes(`-${String(m+1).padStart(2,'0')}-`))
                    events.push({date: `${y}-${s.birth.slice(5)}`, title: `${s.name} ìƒì¼`, type:'birthday'});
            });
        }

        const first = new Date(y, m, 1).getDay();
        const last = new Date(y, m+1, 0).getDate();
        for(let i=0; i<first; i++) grid.innerHTML += `<div></div>`;
        for(let d=1; d<=last; d++) {
            const dateStr = `${y}-${String(m+1).padStart(2,'0')}-${String(d).padStart(2,'0')}`;
            const dots = events.filter(e => e.date === dateStr).map(e => `<span class="event-dot dot-${e.type}"></span>`).join('');
            const isToday = dateStr === new Date().toISOString().slice(0,10) ? 'today' : '';
            grid.innerHTML += `<div class="day-cell ${isToday}" onclick="clickDate('${dateStr}')"><span class="day-num">${d}</span><div style="display:flex; gap:2px; justify-content:center;">${dots}</div></div>`;
        }
        updateScheduleList();
    };

    window.clickDate = (date) => {
        selectedDateStr = date;
        window.renderCalendar();
        if(isTeacherMode()) window.openScheduleModal('', '', date);
        else updateScheduleList();
    };

    window.openScheduleModal = (id, title, date) => {
        const modal = document.getElementById('scheduleModal');
        modal.style.display = 'flex';
        document.getElementById('schedId').value = id || '';
        document.getElementById('schedTitle').value = title || '';
        document.getElementById('schedDate').value = date || selectedDateStr;

        const list = document.getElementById('popupSchedList');
        const evts = window.allSchedules.filter(s => s.date === (date||selectedDateStr));
        list.innerHTML = evts.length ? evts.map(e => `<div style="padding:5px; border-bottom:1px solid #eee;">ğŸ“… ${e.title}</div>`).join('') : "ì¼ì • ì—†ìŒ";
    };

    window.saveSchedule = async () => {
        const id = document.getElementById('schedId').value;
        const title = document.getElementById('schedTitle').value;
        const date = document.getElementById('schedDate').value;
        if(id) await updateDoc(doc(db, "schedules", id), { title, date });
        else await addDoc(collection(db, "schedules"), { title, date });
        document.getElementById('scheduleModal').style.display = 'none';
    };
    window.deleteSchedule = async () => {
        if(confirm("ì‚­ì œ?")) await deleteDoc(doc(db, "schedules", document.getElementById('schedId').value));
        document.getElementById('scheduleModal').style.display = 'none';
    };

    function updateScheduleList() {
        const list = document.getElementById('dailyEventList');
        if(!list) return;
        const evts = window.allSchedules.filter(s => s.date === selectedDateStr);
        list.innerHTML = evts.length ? evts.map(e => `<div>ğŸ“… ${e.title}</div>`).join('') : "<div style='color:#ccc;'>ì¼ì • ì—†ìŒ</div>";
    }

    window.changeCalDate = (n) => { calDate.setMonth(calDate.getMonth() + n); window.renderCalendar(); };
    window.changeListView = () => {}; // ë·°ëª¨ë“œ ë³€ê²½ placeholder

    // ==========================================
    // 9. í‚¤ì˜¤ìŠ¤í¬ ëª¨ë“œ (ìë™ SMS ë³µêµ¬ë¨)
    // ==========================================
    window.startKioskMode = () => {
        if(confirm("ì¶œì„ë¶€ ëª¨ë“œ ì‹œì‘?")) { setKioskSaved(true); document.body.classList.add('kiosk-mode'); applyAccessUI(); window.showPage('list'); }
    };
    window.exitKioskMode = () => {
        if(prompt("ë¹„ë°€ë²ˆí˜¸")==="1234") { setKioskSaved(false); document.body.classList.remove('kiosk-mode'); applyAccessUI(); window.showPage('list'); }
    };
    window.setKioskCategory = (cat, btn) => {
        currentKioskCategory = cat;
        document.querySelectorAll('.k-filter-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        window.filterList();
    };

    // [ì¤‘ìš”] í‚¤ì˜¤ìŠ¤í¬ ë“±í•˜ì› íƒ­ (ë¬¸ì ë°œì†¡ í¬í•¨)
    window.kioskTapAttendance = async (id) => {
        const s = window.allStudents.find(st => st.id === id);
        const todayStr = new Date().toDateString();
        const hasArrived = (s.attendanceLog || []).some(log => new Date(log.seconds ? log.seconds*1000 : log).toDateString() === todayStr);
        const now = new Date();
        const timeStr = now.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});

        // ì• ë‹ˆë©”ì´ì…˜ íš¨ê³¼
        const card = document.getElementById(`card-${id}`);
        if(card) {
            card.style.transform = "scale(0.95)";
            setTimeout(() => card.style.transform = "scale(1)", 150);
        }

        const msg = hasArrived ? `${s.name}, í•˜ì› ì²˜ë¦¬ê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.` : `${s.name}, ë“±ì› ì²˜ë¦¬ê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.`;
        speakText(msg);

        if(!hasArrived) {
            // ë“±ì› ì²˜ë¦¬
            await updateDoc(doc(db, "students", id), { attendanceLog: arrayUnion(now) });
            // [ë³µêµ¬ë¨] ìë™ ë“±ì› ë¬¸ì
            if(s.phone) sendSmsByServer(s.phone.replace(/-/g,''), `[ë¯¸ë˜ì—”ìˆ˜í•™] ${s.name} í•™ìƒì´ ${timeStr}ì— ë“±ì›í–ˆìŠµë‹ˆë‹¤.`);
        } else {
            // í•˜ì› ì²˜ë¦¬
            await updateDoc(doc(db, "students", id), { attendanceOutLog: arrayUnion(now) });
            // [ë³µêµ¬ë¨] ìë™ í•˜ì› ë¬¸ì
            if(s.phone) sendSmsByServer(s.phone.replace(/-/g,''), `[ë¯¸ë˜ì—”ìˆ˜í•™] ${s.name} í•™ìƒì´ ${timeStr}ì— í•˜ì›í–ˆìŠµë‹ˆë‹¤.`);
        }
    };

    // ìŒì„± ì•ˆë‚´ (TTS)
    function speakText(txt) {
        if(!window.speechSynthesis) return;
        window.speechSynthesis.cancel();
        const u = new SpeechSynthesisUtterance(txt);
        u.lang = 'ko-KR'; u.rate = 0.9;
        window.speechSynthesis.speak(u);
    }

    // ì„ ìƒë‹˜ ëª¨ë“œ ì „í™˜
    window.toggleAdminMode = (force) => {
        const chk = document.getElementById('adminToggle');
        if(force === true || chk.checked) {
            if(force !== true && prompt("ë¹„ë²ˆ:") !== "1234") { chk.checked = false; return; }
            setTeacherMode(true);
            applyAccessUI();
            window.showPage('list');
        } else {
            setTeacherMode(false);
            applyAccessUI();
            window.showPage('calendar');
        }
    };

    // í˜ì´ì§€ ì „í™˜
    window.showPage = (id) => {
        document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        document.getElementById(id).classList.add('active');

        const tabs = document.querySelectorAll('.tab-btn');
        if(id==='register') tabs[0].classList.add('active');
        if(id==='list') tabs[1].classList.add('active');
        if(id==='calendar') tabs[2].classList.add('active');
        if(id==='inbox') tabs[3].classList.add('active');

        if(id==='calendar') window.renderCalendar();
        if(id==='list') window.filterList();
    };

    window.setGradeFilter = (val, btn) => {
        currentGradeFilter = val;
        document.querySelectorAll('.filter-chip').forEach(c => c.classList.remove('active'));
        btn.classList.add('active');
        window.filterList();
    };

    window.updateSchoolOptions = () => {
        const schools = new Set();
        window.allStudents.forEach(s => { if(s.school) schools.add(s.school); });
        const sel = document.getElementById('schoolFilter');
        if(sel) {
            sel.innerHTML = '<option value="all">ì „ì²´ í•™êµ</option>';
            schools.forEach(sc => sel.innerHTML += `<option value="${sc}">${sc}</option>`);
        }
    };

    window.triggerPhotoEdit = () => { if(isTeacherMode()) document.getElementById('editPhotoInput').click(); };
    window.previewEditPhoto = async () => {
        const file = document.getElementById('editPhotoInput').files[0];
        if(file) document.getElementById('modalImg').src = await resizeImage(file);
    };
    window.switchModalTab = (id, btn) => {
        document.querySelectorAll('.modal-tab-pane').forEach(p => p.style.display = 'none');
        document.getElementById(id).style.display = 'block';
        document.querySelectorAll('.modal-tab-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
    };

    // ê¸°íƒ€ ìœ í‹¸ (ë°±ì—…/ë³µêµ¬)
    window.downloadExcel = () => {
        const data = window.allStudents.map((s, i) => ({ "No": i+1, "ì´ë¦„": s.name, "í•™êµ": s.school, "í•™ë…„": s.belt, "ë¶€ëª¨ë‹˜": s.phone }));
        const ws = XLSX.utils.json_to_sheet(data);
        const wb = XLSX.utils.book_new();
        XLSX.utils.book_append_sheet(wb, ws, "ëª…ë‹¨");
        XLSX.writeFile(wb, `ì›ìƒëª…ë‹¨_${new Date().toISOString().slice(0,10)}.xlsx`);
    };
    window.downloadBackup = () => {
        const blob = new Blob([JSON.stringify(window.allStudents)], {type: "application/json"});
        const a = document.createElement('a'); a.href = URL.createObjectURL(blob);
        a.download = "backup.json"; a.click();
    };
    window.restoreData = (e) => {
        const reader = new FileReader();
        reader.onload = async (evt) => {
            const data = JSON.parse(evt.target.result);
            if(confirm(`${data.length}ëª… ë³µêµ¬?`)) {
                for(const s of data) { const { id, ...rest } = s; await addDoc(collection(db, "students"), { ...rest, regDate: serverTimestamp() }); }
                alert("ë³µêµ¬ ì™„ë£Œ");
            }
        };
        reader.readAsText(e.target.files[0]);
    };
    window.changeAdminPassword = async () => {
        const newPw = prompt("ìƒˆ ë¹„ë°€ë²ˆí˜¸:");
        if(newPw) { await setDoc(doc(db, "settings", "admin"), { password: newPw }); alert("ë³€ê²½ë¨"); }
    };

    // ì´ˆê¸° ì‹¤í–‰
    window.onload = () => {
        const kioskSaved = isKioskSaved();
        if(kioskSaved) document.body.classList.add('kiosk-mode');
        applyAccessUI();
        if(isTeacherMode() || kioskSaved) window.showPage('list');
        else window.showPage('calendar');
    };
</script>
<div id="toast" class="toast" aria-live="polite" aria-atomic="true">
    <span class="dot"></span><span id="toastText"></span>
</div>

<div class="modal-overlay" id="settingsModal">
    <div class="modal" style="max-width:340px;">
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px; border-bottom:1px solid #eee; padding-bottom:10px;">
            <h3 style="margin:0;">âš™ï¸ ê´€ë¦¬ì ì„¤ì •</h3>
            <button onclick="document.getElementById('settingsModal').style.display='none'" style="border:none; background:none; font-size:20px;">&times;</button>
        </div>

        <div style="display:grid; gap:10px;">
            <button class="action-btn" onclick="startKioskMode()" style="background:#fffbeb; color:#b45309; border:1px solid #fcd34d; box-shadow:none;">
                <i class="fas fa-tablet-alt"></i> ì¶œì„ë¶€ ëª¨ë“œ ì‹œì‘
            </button>
            <button class="action-btn" onclick="downloadExcel()" style="background:#f0fdf4; color:#15803d; border:1px solid #86efac; box-shadow:none;">
                <i class="fas fa-file-excel"></i> ì—‘ì…€ ëª…ë‹¨ ì €ì¥
            </button>
            <button class="action-btn" onclick="downloadBackup()" style="background:#eff6ff; color:#1d4ed8; border:1px solid #93c5fd; box-shadow:none;">
                <i class="fas fa-download"></i> ë°ì´í„° ë°±ì—… (JSON)
            </button>
            <button class="action-btn" onclick="document.getElementById('restoreInput').click()" style="background:#faf5ff; color:#7e22ce; border:1px solid #d8b4fe; box-shadow:none;">
                <i class="fas fa-upload"></i> ë°ì´í„° ë³µêµ¬
            </button>
            <button class="action-btn" onclick="changeAdminPassword()" style="background:#fff1f2; color:#be123c; border:1px solid #fda4af; box-shadow:none;">
                <i class="fas fa-key"></i> ê´€ë¦¬ì ë¹„ë²ˆ ë³€ê²½
            </button>
        </div>
        <input type="file" id="restoreInput" accept=".json" style="display:none" onchange="restoreData(event)">
    </div>
</div>
</body>
</html>
